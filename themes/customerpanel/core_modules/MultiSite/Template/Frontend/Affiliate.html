<style type="text/css">
/* <![CDATA[ */
#PaypalEmailAddress a {color: #000000;}
#PaypalEmailAddress a:hover {color: #4C9CCF;}
/* ]]> */
</style>
<div id="multisite_affiliate_profile_attribute_id">
    <div class="grid-elm grid-align-1-1 grid-offset">
        <!-- BEGIN showAffiliateId -->
        <div class="affiliate-profile-attribute-id" id="setAffiliateId">
            <div> <label>{TXT_CORE_MODULE_MULTISITE_AFFILIATE_PROFILE_ATTR_ID} : </label> {MULTISITE_AFFILIATE_PROFILE_ATTR_ID}</div>
            <div> <label>{TXT_CORE_MODULE_MULTISITE_REFERRALS_LABEL} : </label> {MULTISITE_AFFILIATE_REFERRALS_COUNT}</div>
            <!-- BEGIN showReferralsSubscriptionCount -->
            <div> <label>{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTIONS_REFERRALS_LABEL} : </label></div>
            <!-- BEGIN showSubscriptionsCountByProduct -->
            <div> <label>{MULTISITE_SUBSCRIPTIONS_PRODUCT_NAME} : {MULTISITE_SUBSCRIPTIONS_COUNT_BASED_ON_PRODUCT}</label></div>
            <!-- END showSubscriptionsCountByProduct -->
            <!-- END showReferralsSubscriptionCount -->
            
            <!-- BEGIN showNoReferralsErrorMsg -->
            <div> <label>{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTIONS_NO_REFERRALS_SIGNUP}</label></div>
            <!-- END showNoReferralsErrorMsg -->
       </div>
        <!-- END showAffiliateId -->
        <!-- BEGIN showPaypalEmailAddress -->
        <div id="PaypalEmailAddress">
            <div>
                <label>{TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL} : </label> {MULTISITE_PAYPAL_EMAIL_ADDRESS}&nbsp;
                <a class="entypo-tools" href="#" data-target="#multisite_paypal_email_address_form" data-toggle="modal"></a>
            </div>
        </div>
        <!-- END showPaypalEmailAddress -->
        <!-- BEGIN showAffiliateForm -->
        <form id="affiliate-form" method="post">
        <!-- BEGIN showAffiliateIdForm -->
        <div id="setAffiliateId">
            <label>{TXT_CORE_MODULE_MULTISITE_CHOOSE_AFFILIATE_PROFILE_ATTR_ID} : </label>
                    <input type="text" name="affiliateProfileAttributeId" id="affiliateProfileAttributeId" style="width: 20%;" value="">
                    <div class="errorBlock"></div>
        </div>
        <!-- END showAffiliateIdForm -->
        <!-- BEGIN showPaypalEmailAddressForm -->
        <div id="paypal-mail">
            <label style="width: 25%;">{TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL} : </label>
                <input type="email" id="paypalEmail" style="width: 20%;" name="paypalEmailAddress" value="">
                <div class="errorBlock"></div>
        </div>
        <!-- END showPaypalEmailAddressForm -->
        </form>
        <button style="margin-top: 0px;" type="submit" class="btn save loadingProcess" onclick="saveAffiliateIdAndPayPalMailAddress(jQuery(this))" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}">{TXT_CORE_MODULE_MULTISITE_SAVE}</button>
        <span>{MULTISITE_AFFILIATE_ID_NOT_SET_NOTE}</span> 
        <!-- END showAffiliateForm -->
    </div>
</div>
<div aria-hidden="true" class="modal fade" id="multisite_paypal_email_address_form" role="dialog" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="grid-elm grid-align-1-1 grid-offset">
                <form role="form" action="{MULTISITE_USER_PROFILE_SUBMIT_URL}" id="multisite_user_profile_form">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h2>{TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL}</h2>
                    <fieldset>
                        <div class="row">
                            {TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL_LABEL}:
                        </div>
                        <!-- BEGIN multisite_user_profile_attribute_list -->       
                        <div class="row">
                            <label for="{MULTISITE_USER_PROFILE_ATTRIBUTE_ID}">{MULTISITE_USER_PROFILE_ATTRIBUTE_DESC}</label>{MULTISITE_USER_PROFILE_ATTRIBUTE}
                            <div class="errorBlock"></div>
                        </div>
                        <!-- END multisite_user_profile_attribute_list --> 			
                        <div class="row">
                            <button type="submit" class="save loadingProcess" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}">{TXT_CORE_MODULE_MULTISITE_SAVE}</button>
                            <button type="button" class="" data-dismiss="modal">{TXT_CORE_MODULE_MULTISITE_CANCEL}</button>
                        </div>
                    </fieldset>
                </form>    
            </div>
        </div>
    </div>
    <script type="text/javascript">
        jQuery(document).ready(function(){
            $paypalEmailAddress = '{MULTISITE_PAYPAL_EMAIL_ADDRESS}';
            $paypalEmailAddressId = 'input[name="multisite_user_profile_attribute[{MULTISITE_PAYPAL_EMAIL_ATTRIBUTE_ID}][0]"]';
            
            jQuery('#multisite_paypal_email_address_form').on('hidden.bs.modal', function() {
                jQuery($paypalEmailAddressId).val($paypalEmailAddress);
            });
            
            jQuery('#multisite_paypal_email_address_form').submit(function(){
                var paypalEmailId = jQuery($paypalEmailAddressId).val();
                if ((paypalEmailId.length > 0) && !isValidEmail(paypalEmailId)) {
                    showErrorBlock(jQuery('#multisite_paypal_email_address_form .errorBlock'), '{TXT_CORE_MODULE_MULTISITE_PAYPAL_EMAIL_ADDRESS_ERROR}');
                    return false;
                } else {
                    hideErrorBlock(jQuery('#multisite_paypal_email_address_form .errorBlock'));                        
                }
                var options = {
                    callback: function() {
                        window.location.reload();
                    }
                };
                sendApiFormRequest('#multisite_user_profile_form', 
                                   '#multisite_paypal_email_address_form', ' ', ' ', 
                                   options
                                  );
                return false;
            });
        });
        </script>
</div>
<script type="text/javascript">
    /* <![CDATA[ */
    cx.ready(function(){
        //Disable the save button if no input given.
        if (   (   jQuery("#affiliateProfileAttributeId").length 
                && jQuery("#affiliateProfileAttributeId").val() === ''
               )
               || jQuery("#paypalEmail").val() === ''
            ) {
            jQuery(".save").prop('disabled', true);
        }
        
        jQuery.getScript(cx.variables.get('path', 'contrexx') + "core_modules/MultiSite/View/Script/CustomerPanel.js", function(){
           jQuery.getScript(cx.variables.get('path', 'contrexx') + "lib/javascript/jquery/bootstrapvalidator/js/bootstrapValidator.min.js", function() {
               jQuery("#affiliateProfileAttributeId").bind("input",function(){
                    this.value = this.value.toLowerCase();
                    if (this.value.length > 0) {
                        checkAvailablityOfAffiliateId(this.value);
                    } else {
                        hideErrorBlock(jQuery('#setAffiliateId .errorBlock'));
                        enableOrDisableButton();
                    }
                });
                jQuery("#paypalEmail").blur("change",function(){
                    var mailId  = this.value;
                    if ((mailId.length > 0) && !isValidEmail(mailId)) {
                        showErrorBlock(jQuery('#paypal-mail .errorBlock'), '{TXT_CORE_MODULE_MULTISITE_PAYPAL_EMAIL_ADDRESS_ERROR}');
                    } else {
                        hideErrorBlock(jQuery('#paypal-mail .errorBlock'));                        
                    }
                    enableOrDisableButton();
                });
           });            
       }); 
    });
   /* ]]> */
</script>

