<style type="text/css">
/* <![CDATA[ */
.actions a {color: #000000;}
.actions a:hover {color: #4C9CCF;}
.table {display: table; margin-bottom: 0px;}
.table-row{display: table-row;}
.table-cell{display: table-cell;}
/* ]]> */
</style>
<div id="multisite_affiliate_profile_attribute_id">
    <div class="grid-elm grid-align-1-1 grid-offset">
        <form id="affiliate-form" method="post">
            <div class="show-affiliate-paypal-profile-attribute-id">
                <div class="table">
                    <!-- BEGIN showAffiliateIdForm -->
                    <div class="table-row">
                        <div class="table-cell" style="width: 25%;">
                            <label>{TXT_CORE_MODULE_MULTISITE_CHOOSE_AFFILIATE_PROFILE_ATTR_ID}</label>
                        </div>
                        <div class="table-cell">:</div>
                        <div class="table-cell">
                            <input type="text" name="affiliateProfileAttributeId" id="affiliateProfileAttributeId" style="width: 25%;" value="">
                        </div>
                    </div>
                    <div id="setAffiliateId" class="table-row">
                        <div class="table-cell"></div>
                        <div class="table-cell"></div>
                        <div class="table-cell">
                            <div class="errorBlock">&nbsp;</div>
                        </div>
                    </div>
                    <!-- END showAffiliateIdForm -->

                    <!-- BEGIN showAffiliateIdPartOne -->
                    <div class="table-row">
                        <div class="table-cell" style="width: 20%;">
                            <label>{TXT_CORE_MODULE_MULTISITE_AFFILIATE_PROFILE_ATTR_ID}</label>
                        </div>
                        <div class="table-cell">:</div>
                        <div class="table-cell">{MULTISITE_AFFILIATE_PROFILE_ATTR_ID}</div>
                    </div>
                    <!-- END showAffiliateIdPartOne -->

                    <!-- BEGIN showPaypalEmailAddressForm -->
                    <div class="table-row">
                        <div class="table-cell" style="width: 20%;">
                            <label>{TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL}</label>
                        </div>
                        <div class="table-cell">:</div>
                        <div class="table-cell">
                            <input type="email" id="paypalEmail" style="width: 25%;" name="paypalEmailAddress" value="{MULTISITE_PAYPAL_EMAIL_ADDRESS}">
                        </div>
                    </div>
                    <div id="paypalAccountAddress" class="table-row">
                        <div class="table-cell"></div>
                        <div class="table-cell"></div>
                        <div class="table-cell">
                            <div class="errorBlock">&nbsp;</div>
                        </div>
                    </div>
                    <!-- END showPaypalEmailAddressForm -->

                    <!-- BEGIN showPaypalEmailAddress -->
                    <div class="table-row">
                        <div class="table-cell" style="width: 20%;">
                            <label>{TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL}</label>
                        </div>
                        <div class="table-cell">:</div>
                        <div class="table-cell actions">
                            {MULTISITE_PAYPAL_EMAIL_ADDRESS}
                            <a class="entypo-tools" href="#" data-target="#multisite_paypal_email_address_form" data-toggle="modal"></a>
                        </div>
                    </div>
                    <!-- END showPaypalEmailAddress -->
                </div>

                <div class="table">
                    <div class="table-row">
                        <!-- BEGIN showAffiliateForm -->
                        <div class="table-cell" style="width: 10%;">
                            <button style="margin-top: 0px;" type="submit" class="btn save loadingProcess" onclick="saveAffiliateIdAndPayPalMailAddress(jQuery(this))" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}">{TXT_CORE_MODULE_MULTISITE_SAVE}</button>
                        </div>
                        <!-- END showAffiliateForm -->

                        <!-- BEGIN showNoAffiliateErrorMsg -->
                        <div class="table-cell">
                            <label>{TXT_CORE_MODULE_MULTISITE_AFFILIATE_ID_NOT_SET_NOTE}</label>
                        </div>
                        <!-- END showNoAffiliateErrorMsg -->
                    </div>
                </div>

                <!-- BEGIN showAffiliateIdPartTwo -->
                <div class="table">
                    <div class="table-row">
                        <div class="table-cell">&nbsp;</div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell" style="width:12%">
                            <label>{TXT_CORE_MODULE_MULTISITE_REFERRALS_LABEL}</label>
                        </div>
                        <div class="table-cell" style="width:1%">:</div>
                        <div class="table-cell">
                            {MULTISITE_AFFILIATE_REFERRALS_COUNT}
                        </div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell">&nbsp;</div>
                    </div>
                </div>

                <!-- BEGIN showReferralsSubscriptionCount -->
                <div class="table">
                    <div class="table-row">
                        <div class="table-cell">
                            <label>{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTIONS_REFERRALS_LABEL} : </label>
                        </div>
                    </div>
                </div>
                <div class="table" style="margin-left: 40px;">
                    <!-- BEGIN showSubscriptionsCountByProduct -->
                    <div class="table-row">
                        <div class="table-cell" style="width:8%">
                            <label>{MULTISITE_SUBSCRIPTIONS_PRODUCT_NAME}</label>
                        </div>
                        <div class="table-cell" style="width:1%">:</div>
                        <div class="table-cell">
                            {MULTISITE_SUBSCRIPTIONS_COUNT_BASED_ON_PRODUCT}
                        </div>
                    </div>
                    <!-- END showSubscriptionsCountByProduct -->
                </div>

                <!-- END showReferralsSubscriptionCount -->

                <!-- BEGIN showNoReferralsErrorMsg -->
                <div class="table">
                    <div class="table-row">
                        <div class="table-cell">
                            <label>{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTIONS_NO_REFERRALS_SIGNUP}</label>
                        </div>
                    </div>
                </div>
                <!-- END showNoReferralsErrorMsg -->
                <!-- END showAffiliateIdPartTwo -->
           </div>
        </form>
    </div>
</div>
<div aria-hidden="true" class="modal fade" id="multisite_paypal_email_address_form" role="dialog" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="grid-elm grid-align-1-1 grid-offset">
                <form role="form" action="{MULTISITE_USER_PROFILE_SUBMIT_URL}" id="multisite_user_profile_form">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h2>{TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL}</h2>
                    <fieldset>
                        <div class="row">
                            {TXT_CORE_MODULE_MULTISITE_PAYPAL_ACCOUNT_EMAIL_LABEL}:
                        </div>
                        <!-- BEGIN multisite_user_profile_attribute_list -->       
                        <div class="row">
                            <label for="{MULTISITE_USER_PROFILE_ATTRIBUTE_ID}">{MULTISITE_USER_PROFILE_ATTRIBUTE_DESC}</label>{MULTISITE_USER_PROFILE_ATTRIBUTE}
                            <div class="errorBlock">&nbsp;</div>
                        </div>
                        <!-- END multisite_user_profile_attribute_list --> 			
                        <div class="row">
                            <button type="submit" class="save loadingProcess" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}">{TXT_CORE_MODULE_MULTISITE_SAVE}</button>
                            <button type="button" class="" data-dismiss="modal">{TXT_CORE_MODULE_MULTISITE_CANCEL}</button>
                        </div>
                    </fieldset>
                </form>    
            </div>
        </div>
    </div>
    <script type="text/javascript">
        jQuery(document).ready(function(){
            $paypalEmailAddress = '{MULTISITE_PAYPAL_EMAIL_ADDRESS}';
            $paypalEmailAddressId = 'input[name="multisite_user_profile_attribute[{MULTISITE_PAYPAL_EMAIL_ATTRIBUTE_ID}][0]"]';
            
            jQuery('#multisite_paypal_email_address_form').on('shown.bs.modal', function() {
                enableOrDisableButton();
            });
            jQuery('#multisite_paypal_email_address_form').on('hidden.bs.modal', function() {
                jQuery($paypalEmailAddressId).val($paypalEmailAddress);
            });
            
            jQuery('#multisite_paypal_email_address_form').submit(function(){
                var paypalEmailId = jQuery($paypalEmailAddressId).val();
                if ((paypalEmailId.length > 0) && !isValidEmail(paypalEmailId)) {
                    showErrorBlock(jQuery('#multisite_paypal_email_address_form .errorBlock'), '{TXT_CORE_MODULE_MULTISITE_PAYPAL_EMAIL_ADDRESS_ERROR}');
                    return false;
                } else {
                    hideErrorBlock(jQuery('#multisite_paypal_email_address_form .errorBlock'));                        
                }
                var options = {
                    callback: function() {
                        window.location.reload();
                    },
                    beforesend: function($opt) {
                        $opt.button('loading');
                        $opt.prop('disabled', true);
                        $opt.removeClass('save');
                    },
                    complete: function($opt) {
                        $opt.button('reset');
                        $opt.prop('disabled', false);
                        $opt.addClass('save');
                    }
                };
                sendApiFormRequest('#multisite_user_profile_form', 
                                   '#multisite_paypal_email_address_form', ' ', ' ', 
                                   options
                                  );
                return false;
            });
        });
        </script>
</div>
<script type="text/javascript">
    /* <![CDATA[ */
    cx.ready(function(){
        //Disable the save button if no input given.
        if (   (   jQuery("#affiliateProfileAttributeId").length 
                && jQuery("#affiliateProfileAttributeId").val() === ''
               )
               || jQuery("#paypalEmail").val() === ''
            ) {
            jQuery(".save").prop('disabled', true);
        }
        
        jQuery.getScript(cx.variables.get('path', 'contrexx') + "core_modules/MultiSite/View/Script/CustomerPanel.js", function(){
           jQuery.getScript(cx.variables.get('path', 'contrexx') + "lib/javascript/jquery/bootstrapvalidator/js/bootstrapValidator.min.js", function() {
               jQuery("#affiliateProfileAttributeId").bind("input",function(){
                    this.value = this.value.toLowerCase();
                    if (this.value.length > 0) {
                        checkAvailablityOfAffiliateId(this.value);
                    } else {
                        hideErrorBlock(jQuery('#setAffiliateId .errorBlock'));
                        enableOrDisableButton();
                    }
                });
                jQuery("#paypalEmail").blur("change",function(){
                    var mailId  = this.value;
                    if ((mailId.length > 0) && !isValidEmail(mailId)) {
                        showErrorBlock(jQuery('#paypalAccountAddress .errorBlock'), '{TXT_CORE_MODULE_MULTISITE_PAYPAL_EMAIL_ADDRESS_ERROR}');
                    } else {
                        hideErrorBlock(jQuery('#paypalAccountAddress .errorBlock'));                        
                    }
                    enableOrDisableButton();
                });
           });            
       }); 
    });
   /* ]]> */
</script>

