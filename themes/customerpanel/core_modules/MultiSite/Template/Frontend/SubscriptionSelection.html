<style type="text/css">
/*background-color: rgba(33, 111, 189, 0.9);*/
.prices > div {
    width: 100%;
}
.prices h2 {
    margin: 0.83em 0;
}
.prices-periods h2 {
    background: none;
    margin: 0;
    border: none;
}
.prices #business .header {
    background-color: rgb(33, 111, 189);
    margin-top: -10px;
    color: white;
}
.monthly-prices,
.annual-prices,
.biannual-prices {
    text-align: center;
    padding-right: 15px;
}
.prices-new .prices #business .header {
    background-color: rgb(136, 189, 19);
}
#trial {
     margin-bottom: 5px;
}
#business .buy-now {
    color: black;
    background: white;
    width: 80%;
}
.prices > div .header:empty {
    background-color: transparent;
}
.header{
    border-bottom: 1px solid #dddddd;
    text-align: center;
}
.prices .header .name {
    font-size: 21px;
    text-transform: uppercase;
    width: 100%;
    display: inline-block;
    vertical-align: top;
    padding: 32px 5px;
    font-weight: 500;
}
.features {
    width: 100%;
    display: inline-block;
}
.features ul{
    padding: 0;
    vertical-align: middle;
    margin-top: 10px;
}
.features ul li{
    width: 100%;
    float: left;
    list-style: none;
}
.features ul li.no {
    color: #f00;
}
.product_price {
    width: 100%;
    display: inline-block;
    margin-top: 25px;
}
.prices .header .amount {
    font-size: 28px;
}

.prices .header .currency {
    vertical-align: super;
    position: relative;
    margin-left: -13px;
    top: -10px;
}

.prices > div.description > span {
    text-align: left;
}

.prices h2 .priceplan {
    font-weight: lighter;
}

.prices-periods {
    width: 100%;
    text-align: center;
    background-color: #F1F1F1;
    padding-top: 18px;
    border-bottom: 1px solid #D5D5D5;
}

.prices-new .prices-periods {
    background-color: #FFF;
    border: 1px solid #dadada;
    border-left: none;
    border-right: none;
    height: 50px;
    margin-top: 35px;
    margin-left: 1%;
    max-width: 950px;
    padding: 0;
}

.prices-periods a {
    display: inline-block;
    width: 33%;
    height: 50px;
    line-height: 50px;
    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
    margin-left: -10px;
    vertical-align: bottom;
    font-size: 1.4em;
    position: relative;
    color: rgb(51, 51, 51);
    bottom: -1px;
    border-top: 1px solid #F1F1F1;
    font-size: 14px
}

.prices-periods a.active {
    border-left: 1px solid #dadada;
    border-top: 1px solid #dadada;
    border-right: 1px solid #dadada;
    background-color: white;
    opacity: 1;
}

.prices-periods a.monthly:after,
.prices-periods a.biannually:after {
    font-size: 12px;
    line-height: 12px;
    color: #428bca;
    margin-left: 5px;
}

.prices-periods a.biannually:after {
    content: '-10%';
}

.prices-periods > span {
    padding: 15px 5px 5px 5px;
    display: inline-block;
}

.prices-periods span:hover,
.prices-periods span label:hover {
    cursor: pointer;
}

.prices-periods label {
    font-weight: 100;
    margin-bottom: 0;
    vertical-align: top;
}

.prices-periods input[type="radio"] {
    margin: 3px 5px 0 15px;
}

.prices-periods label[for="biannually"]:after {
    content: "-10%";
    font-size: 10px;
    vertical-align: middle;
    margin-left: 5px;
    color: #428bca;
}

.prices-new h2.annual-prices {
    margin-bottom: 0;
    padding: 0 15px;
}

.prices-new .prices {
    border: none;
}

.monthly-prices,
.biannual-prices {
    display: none;
}

.monthly-prices, .biannual-prices, .annual-prices {
    min-height: 50px;
}
.prices {
    position: relative;
    padding-top: 30px;
}

.prices:before {
    position: absolute;
    content: 'Coming Soon';
    padding-top: 48%;
    box-sizing: border-box;
    color: white;
    font-size: 80px;
    text-align: center;
    left: -2%;
    top: -2%;
    width: 104%;
    height: 104%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 99;
    display: none;
}
.prices .buy-now {
    height: 50px;
    line-height: 50px;
    color: white;
    margin: 10px auto;
    font-weight: bold;
    background: #216fbd;
    width: 80%;
    display: inline-block;
    text-align: center;
}
.prices > .partner-button a,
.prices > .enterprise-button a {
    color: #000;
    display: inline-block;
    padding: 24px 0px;
    width: 100%;
    height: 100%;
    border-box: padding-box;
}

.prices > .partner-button a:hover,
.prices > .enterprise-button a:hover {
    color: #FFF;
    background-color: rgb(149, 199, 0);
}

@media (min-width: 601px) {
    /******************************************
    * PRICES
    ******************************************/
    .contact input[type="submit"],
    .contact input[type="reset"] {
        width: 49.5%;
        display: inline-block;
    }

    /******************************************
    * PRICES
    ******************************************/
    .prices {
        max-width: 100%;
        margin: 0 auto;
        padding: 20px;
        padding-bottom: 0px;
    }

    .prices > div.description:first-child {
        display: inline-block;
    }

    .prices-periods a {
        width: 30%;
        font-size: 1.4em;
    }

    .important-questions h4 {
        text-align: left;
    }
    #SubscriptionSelection .modal-dialog {
        width: 98%;
    }
    
    #order_subscription .modal-dialog {
        width: 58%;
    }
}

@media (min-width: 1025px) {
    /******************************************
     * PRICES
     ******************************************/
    #SubscriptionSelection .modal-dialog {
        width: 90%;
    }

    #order_subscription .modal-dialog {
        width: 50%;
    }
    
    #non-profit {
        margin-right: 0;
    }
    .monthly-prices,
    .annual-prices,
    .biannual-prices {
        text-align: right;
    }
    .prices > .partner-button,
    .prices > .enterprise-button {
        width: calc(48.8% - 4px);
    }

    .prices > .partner-button {
        margin-right: 14px;
    }

    #download .prices .description {
        max-width: 25%;
        margin: 0 auto;
    }
    .features {
        width: 46%;
    }
    .features ul li{
        width: 49.5%;
        list-style-type: disc;
        font-size: 14px;
    }
    .header{
        text-align: left;
    }
    .prices .buy-now{
        width: 18%;
        vertical-align: top;
        margin-top: 20px;
    }
    .product_price {
        width: 19%;
        margin-top: 0px;
        vertical-align: bottom;
    }
    .prices .header .name {
        width: 15%;
    }
    #business .buy-now {
        width: 18%;
    }
}
@media (min-width: 1600px) {
    #SubscriptionSelection .modal-dialog {
        width: 60%;
    }
    
    #order_subscription .modal-dialog {
        width: 25%;
    }
}
@media (min-width: 1900px) {
    .features {
        width: 50%;
    }
    .product_price {
        width: 15%;
    }
}


.biannual-discount {
    font-size: 14px;
    color: rgb(33, 111, 189);
}

.biannual-discount sub {
    bottom: 0;
}

.modal-backdrop.in {
    opacity: .5;
    filter: alpha(opacity=50);
}

.modal-backdrop {
    z-index: 1040;
}

.cancelBtn {
    padding-bottom: 15px;
    padding-left: 20px;
    border-left: 1px solid #D5D5D5;
    border-right: 1px solid #D5D5D5;
    border-bottom-left-radius: 6px;
    border-bottom-right-radius: 6px;
}
.prices{
    margin-bottom: 20px ;
}

#order_confirm {
    width: 3%;
    margin-top: 3px;
}
#confirmOrder {
    margin-right: 5px;
}
.confirm_subscription label {
    font-weight: 300;
}
</style>
<script type="text/javascript">
    jQuery(document).ready(function () {
        jQuery('.prices-periods a').on('click', function (e) {
            e.preventDefault();
            jQuery('.prices-periods a').removeClass('active');
            $class = jQuery(this).attr('class');
            jQuery(this).addClass('active');
            jQuery('.amt').hide();
            jQuery('.' + $class + '-prices').show();
        });
        // cadminPath => available in customerPanel.js
        var subscriptionOptions = {
            id: '{MULTISITE_SUBSCRIPTION_ID}',
            addErrorTxt: '{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_ADD_FAILED}',
            addPaymentErrorTxt: '{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_ADD_PAYMENT_FAILED}',
            addHeaderErrorTxt: '{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_ADD_INPROGRESS}',
            upgradeErrorTxt: '{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_UPGRADE_FAILED}',
            upgradePaymentErrorTxt: '{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_UPGRADE_PAYMENT_FAILED}',
            upgradeHeaderErrorTxt: '{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_UPGRADE_INPROGRESS}',
            websiteName: '{MULTISITE_WEBSITE_NAME}',
            paymentUrl: cadminPath + 'index.php?cmd=JsonData&object=MultiSite&act=getPayrexxUrl',
            ajaxUrl: cadminPath + 'index.php?cmd=JsonData&object=MultiSite&act=manageSubscription',
            hasPayrexxAccount: {MULTISITE_IS_USER_HAS_PAYREXX_ACCOUNT},
            isPaymentUrlRequested: false
        };

        var subscriptionType = ((jQuery.trim(subscriptionOptions.id) != '0') && jQuery.trim(subscriptionOptions.id) != '') ? 'upgrade' : 'add';
        
        //Set Payment Url
        function setPaymentUrl($this) {
            if (subscriptionOptions.isPaymentUrlRequested) {
                return;
            }
            $productId = $this.data('productid');
            $renewalOption = $this.data("renewalOption");
            if ((jQuery.trim($productId) == '')
                    || (jQuery.trim($renewalOption) == '')
            ) {
                showMessage(subscriptionOptions[subscriptionType + 'ErrorTxt'], 'error');
                return false;
            }
            subscriptionOptions.isPaymentUrlRequested = true;
            jQuery.ajax({
                dataType: "json",
                url: subscriptionOptions.paymentUrl,
                data: {
                    product_id: $productId,
                    renewalOption: $renewalOption,
                    multisite_address: subscriptionOptions.websiteName
                },
                type: "POST",
                success: function (response) {
                    subscriptionOptions.isPaymentUrlRequested = false;
                    if (response.status == 'error') {
                        jQuery("#SubscriptionSelection").modal('hide');
                        showMessage(subscriptionOptions[subscriptionType + 'ErrorTxt'], 'error');
                        return;
                    }

                    if (response.status == 'success' && response.data.link) {
                        jQuery('#payrexxModal')
                                .data('href', response.data.link)
                                .trigger('click');
                    }
                }
            });
        }

        jQuery('.buy-now.websiteCollection').on('click', function () {
            buySubscription(jQuery(this));
        });
        
        subscriptionConfirmModalContent();
        
        function buySubscription($this) {
            jQuery('.buy-now').removeClass('subscriptionProduct');
            $this.data('renewalOption', $this.parent().find('.product_price').find('div:visible').attr('data-renewalOption'));
            $this.addClass('subscriptionProduct');
            
            if (getProductPrice($this)) {
                jQuery('#order_subscription').modal('show');
                jQuery('#confirmOrder').click(function() {
                  if (jQuery('#order_confirm:checked').length < 1) {
                      jQuery('div.alert.order_confirm').show();
                      return false;
                  }
                  
                  jQuery('#order_subscription').modal('hide');
                  jQuery('#SubscriptionSelection').modal('hide');
                  if (subscriptionOptions.hasPayrexxAccount) {
                      manageSubscription($this);
                      return;
                  } else {
                      setPaymentUrl($this);
                  }
                });
                
            } else {
                manageSubscription($this);
            }
        }
        
        jQuery('.buy-now.website').on('click', function () {
            if ((jQuery.trim(subscriptionOptions.id) != '0') && jQuery.trim(subscriptionOptions.id) != '') {
                buySubscription(jQuery(this));
                return;
            }

            showRemoteModal({
                modalId: 'SubscriptionAddWebsite',
                remoteUrl: '/api/MultiSite/SubscriptionAddWebsite?productId=' + jQuery(this).data('productid'),
                hidden: function () {
                    var signUpForm = jQuery('#multisite_signup_form');
                    var signUpModal = signUpForm.parents('.modal');
                    signUpModal.unbind();
                }
            });
            jQuery("#SubscriptionSelection").modal('hide');
        });

        function validUrl($url) {
            var urlPattern = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
            if (!urlPattern.test($url)) {
                return false;
            }
            return true;
        }

        function getProductPrice($this) {
            var selectedProduct = $this.parent().find('.product_price > div:visible');
            var productPriceAmount = selectedProduct.data('price');
            if (productPriceAmount != 0) {
                jQuery('#subscription_payment').html(productPriceAmount+ ' / ' +selectedProduct.data('renewaloption'));
                jQuery('#subscription_name').html($this.parent().find('.subscription_name').html());
                return productPriceAmount;
            }
            return false;
        }

        function manageSubscription($this) {
            $ajaxUrl = subscriptionOptions.ajaxUrl;
            $productId = $this.data("productid");
            $renewalOption = $this.data("renewalOption");

            if ((jQuery.trim($ajaxUrl) == '')
                    || (jQuery.trim($productId) == '')
                    || (jQuery.trim($renewalOption) == '')
            ) {
                jQuery('#SubscriptionSelection').modal('hide');
                showMessage(subscriptionOptions[subscriptionType + 'ErrorTxt'], 'error');
                return false;
            }

            jQuery.ajax({
                dataType: "json",
                url: $ajaxUrl,
                data: {
                    product_id: $productId,
                    subscription_id: subscriptionOptions.id,
                    websiteName: subscriptionOptions.websiteName,
                    renewalOption: $renewalOption
                },
                type: "POST",
                beforeSend: function () {
                    jQuery('#SubscriptionSelection').modal('hide');
                    showMessage('<img src="/lib/javascript/jquery/jstree/themes/default/throbber.gif" />   ' + subscriptionOptions[subscriptionType + 'HeaderErrorTxt'], 'info', false);
                },
                success: function (response) {
                    if (response.status == 'success') {
                        $resp = response.data;
                        if ($resp.status == 'success') {
                            showMessage($resp.message, 'success');
                            window.location.href = '{NODE_MULTISITE_SUBSCRIPTIONDETAIL}?id=' + $resp.id;                            
                        } else {
                            showMessage($resp.message, 'error');
                        }
                    } else {
                        showMessage(response.message.message, 'error');
                    }
                }
            });
        }

        jQuery.getScript('https://media.payrexx.com/modal/v1/modal.js', function () {
            jQuery('#payrexxModal').payrexxModal({
                hideObjects: ["#contact-details", ".contact"],
                show: function (e) {
                    $this = jQuery('.buy-now.subscriptionProduct');
                    //Payrexx URL validation
                    if (($this.length < 0) || !validUrl(jQuery('#payrexxModal').data("href"))) {
                        return e.preventDefault();
                    }
                    return true;
                },
                hidden: function (transaction) {
                    switch (transaction.status) {
                        case 'confirmed':
                            manageSubscription($this);
                            break;
                        default:
                            showMessage(subscriptionOptions[subscriptionType + 'PaymentErrorTxt'], 'error');
                            break;
                    }
                }
            });
        });
        
        // load Billable subscription selection modal content
        function subscriptionConfirmModalContent() {
          var modalMainContent = jQuery('<div />');
          var closeButton   = jQuery('<button />');
          var row           = jQuery('<div />').addClass('row'); 
          var modalDialog   = jQuery('<div />').addClass('modal-dialog'); 
          
          var modalContent = jQuery('<div />')
                  .attr({id: "order_subscription", role: "dialog", tabindex: "-1", 'aria-hidden': "true"})
                  .addClass('modal fade');
          
          modalMainContent
                  .addClass('grid-elm grid-align-1-1 grid-offset');
          closeButton.addClass('close')
                     .attr('data-dismiss', 'modal');
          jQuery('<span />')
                  .attr('aria-hidden',true)
                  .html('&times;')
                  .appendTo(closeButton);
          jQuery('<span />')
                  .addClass('sr-only')
                  .html('Close')
                  .appendTo(closeButton);
          closeButton.appendTo(row);
          jQuery('<h2 />').html('{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_NEW_ORDER}')
                  .appendTo(row);
          jQuery('<div />')
                  .addClass('grid-offset-bottom')
                  .append('{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_BILLABLE_SUBSCRIPTION}<br/>')
                  .append('<span><strong>{TXT_MULTISITE_WEBSITE_SUBSCRIPTION}</strong>: <span id="subscription_name"></span></span><br/>')
                  .append('<span><strong>{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_PRICE}</strong>: <span id="subscription_payment"></span></span><br/>')
                  .append('<span class="grid-align-1-1 grid-offset-top confirm_subscription" ><label> <input type="checkbox" id="order_confirm"/> {MULTISITE_ACCEPT_TERMS_URL}</label></span>')
                  .append('<div class="alert alert-danger order_confirm" style="display: none;">{TXT_MULTISITE_ACCEPT_TERMS_ERROR}</div>')
                  .appendTo(row);
          jQuery('<button />')
                  .attr({'data-dismiss': 'modal', 'id': 'confirmOrder'})
                  .addClass('upgrade')
                  .append('{TXT_CORE_MODULE_MULTISITE_SUBSCRIPTION_ORDER} ')
                  .appendTo(row);
          jQuery('<button />')
                  .attr('data-dismiss', 'modal')
                  .addClass('cancel')
                  .append('{TXT_CORE_MODULE_MULTISITE_CANCEL} ')
                  .appendTo(row);
          row.appendTo(modalMainContent);
          var modalbody = jQuery('<div />')
                  .addClass('modal-body')
                  .append(modalMainContent);
          jQuery('<div />').addClass('modal-content')
                  .append(modalbody)
                  .appendTo(modalDialog);
                 modalDialog.appendTo(modalContent);
          return modalContent.on("hidden.bs.modal",
                    function () {
                        jQuery('.order_confirm').hide();
                        jQuery('#order_confirm').prop('checked', false);
                    }
                ).appendTo('body');
        }    
      });
</script>

<div class="prices-periods">
    <h2><span class="priceplan">{TXT_MULTISITE_WEBSITE_PRODUCT_PRICE_MODEL}</span></h2>
    <a class="monthly" href="#">{TXT_MULTISITE_WEBSITE_PRODUCT_MONTHLY}</a>
    <a class="annual active" href="#">{TXT_MULTISITE_WEBSITE_PRODUCT_ANNUALLY}</a>
    <a class="biannual" href="#">{TXT_MULTISITE_WEBSITE_PRODUCT_BIANNUALLY}
        <span class="biannual-discount">
            <sub> - 10% </sub>
        </span>
    </a>
</div>

<div class="prices">
    <input type="hidden" name="subscriptionId" id="subscriptionId" value="{MULTISITE_SUBSCRIPTION_ID}"/>
    <a id="payrexxModal" class="hide" href="javascript:void(0)" data-href=""></a>

    <!-- BEGIN showProduct -->
    <div id="{MULTISITE_WEBSITE_PRODUCT_ATTRIBUTE_ID}">
        <div class="header">
            <span class="name subscription_name">{MULTISITE_WEBSITE_PRODUCT_NAME}</span>
            <div class="features">
                {MULTISITE_WEBSITE_PRODUCT_NOTE_PRICE}
            </div>
            <div class="product_price">
                <div class="monthly-prices amt" style="display: none;" data-renewalOption="monthly" data-price="{MULTISITE_WEBSITE_PRODUCT_PRICE_MONTHLY}">
                    <span class="amount">{MULTISITE_WEBSITE_PRODUCT_PRICE_MONTHLY}.-</span>
                    <span class="currency">CHF</span>
                </div>

                <div class="annual-prices amt" style="display: block;" data-renewalOption="annually" data-price="{MULTISITE_WEBSITE_PRODUCT_PRICE_ANNUALLY}">
                    <span class="amount">{MULTISITE_WEBSITE_PRODUCT_PRICE_ANNUALLY}.-</span>
                    <span class="currency">CHF</span>
                </div>

                <div class="biannual-prices amt" style="display: none;" data-renewalOption="biannually" data-price="{MULTISITE_WEBSITE_PRODUCT_PRICE_BIANNUALLY}">
                    <span class="amount">{MULTISITE_WEBSITE_PRODUCT_PRICE_BIANNUALLY}.-</span>
                    <span class="currency">CHF</span>
                </div>
            </div>
            <a class="buy-now {MULTISITE_PRODUCT_TYPE}" href="javascript:void(0)" data-productid="{MULTISITE_WEBSITE_PRODUCT_ID}">{TXT_MULTISITE_WEBSITE_CHOOSE}</a>
        </div>
    </div>
    <!-- END showProduct -->
</div>
<div class="cancelBtn">
    <input type="button" data-dismiss="modal" value="{TXT_CORE_MODULE_MULTISITE_CANCEL}"/>
</div>
