<html>
<head>
<title>Contrexx File Uploader</title>
<meta http-equiv="Content-Type" content="text/html; charset={CONTREXX_CHARSET}" />
<meta name="robots" content="noindex" />
<meta name="robots" content="nofollow" />
<meta name="robots" content="noarchive" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<link href="template/ascms/css/base.css" rel="stylesheet" type="text/css" />
<script language="javascript" type="text/javascript">
// <![CDATA[
function closeWindow()
{
	window.opener.focus();
	window.top.close();
}

/**
 * resize applet to fit client area
 * @param applet an applet to resize
 * @param dx a horizontal space to substract from client area width
 * @param dy a vertical space to substract from client area width
 */
function resizeApplet()
{
    var applet = document.jumpLoaderApplet;
    var w_newWidth, w_newHeight;
    var w_maxWidth = 2600, w_maxHeight = 2200;
    var dx = 0;
    var dy = 50;
    if( navigator.appName.indexOf( "Microsoft" ) != -1 ) {
        w_newWidth = document.body.clientWidth;
        w_newHeight = document.body.clientHeight;
    } else {
        w_newWidth = window.innerWidth;
        w_newHeight = window.innerHeight;
    }
    if( w_newWidth > w_maxWidth ) {
        w_newWidth = w_maxWidth;
    }
    if( w_newHeight > w_maxHeight ) {
        w_newHeight = w_maxHeight;
    }
    applet.width = w_newWidth - dx;
    applet.height = w_newHeight - dy;
    applet.setSize( w_newWidth - dx, w_newHeight - dy );
}

/**
 * Used to store the names of the uploaded files
 */
aUploadedFiles = new Array();

function uploaderStatusChanged(uploader)
{
    var status = parseInt(uploader.getStatus(), 10);
    switch (status) {
        case 0:
            /**
             * Reload opener window with passing the list of uploaded files in JSON
             * packed into the url modifier "highlightFiles".
             */
            sFiles = '&highlightFiles=';
            sFiles += encodeURIComponent('["' + aUploadedFiles.join('", "') + '"]');
            window.opener.location.replace(window.opener.location.href+sFiles);

            // enable close button
            document.getElementById('fileUploaderClose').disabled = false;
            document.getElementById('fileUploaderClose').style.backgroundColor = '';
            break;

        case 1:
            // disable close button
            document.getElementById('fileUploaderClose').disabled = true;
            document.getElementById('fileUploaderClose').style.backgroundColor = '#CCCCCC';
            break;
    }
}

function uploaderFileStatusChanged(uploader, file)
{
    /**
     * Add successfully uploaded files to the list (aUploadedFiles) of
     * uploaded files.
     */
    if (uploader.getStatus() == 1 && file.getStatus() == 2) {
        aUploadedFiles[aUploadedFiles.length] = file.getResponseContent().toString()
    }
}

function appletInitialized(applet)
{
    /**
     * Set UserAgent of applet to the browser's one
     */
    applet.getUploaderConfig().setUserAgent(navigator.userAgent);
}
// ]]>
</script>
</head>
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onResize="resizeApplet()" onLoad="resizeApplet()">
    <applet name="jumpLoaderApplet"
            code="jmaster.jumploader.app.JumpLoaderApplet.class"
            archive="{FILEUPLOADER_LANG_PATH},{FILEUPLOADER_APPLET_PATH}"
            width="800"
            height="600" mayscript>

        <param name="uc_uploadUrl" value="{FILEUPLOADER_HANDLER_PATH}" />
        <param name="uc_partitionLength" value="{FILEUPLOADER_PARTITION_LENGTH}" />
		<param name="gc_loggingLevel" value="FATAL" />
        <param name="ac_fireAppletInitialized" value="true"/>
        <param name="ac_fireUploaderFileStatusChanged" value="true"/>
        <param name="ac_fireUploaderStatusChanged" value="true"/>
		<param name="vc_uploadListViewName" value="_compact"/>
		<param name="vc_useThumbs" value="false"/>
		<param name="vc_lookAndFeel" value="system"/>
    </applet>
    <div style="text-align:right; margin:10px;">
        <input type="button" id="fileUploaderClose" onclick="window.close();" value="{TXT_FILEUPLOADER_CLOSE}" />
    </div>
</body>
</html>
