<style type="text/css">
    /* jquery ui css customization */
    .ui-dialog.cxDialog {
        position: absolute;
        top: 0 !important;
        border-top: 0;
        border-right: 1px solid #0a85c8;
        border-bottom: 1px solid #0a85c8;
        border-left: 1px solid #0a85c8;
        border-radius: 0;
        text-align: center;
    }

    .ui-dialog.noTitle .ui-dialog-titlebar {
        display: none;
    }
    .ui-dialog .error {
        color: #ff0000;
    }
    .ui-dialog #loading {
        float: none;
        margin: 0 auto;
        width: 95px !important;
        height: 16px !important;
    }
    .ui-dialog #loading img {
        float: left;
    }
    #help1, #help2, #help3, help4, #help5, #help6, #help7, #help8 {display: none;padding-left: 5px;} 
</style>
<script type="text/javascript">
var modifySurvey = {
    _moveToNextTab: function() {
        current = $J("ul#tabmenu > li").has("a.active");
        if (current.next().length) {
            target = current.next();
        } else {
            target = $J("ul#tabmenu > li:first"); // This will not happen
        }
        target.find("a").trigger("click");
    }
};
$J(function(){
    $J("ul#tabmenu > li").click(function() {
        if ($J(this).next().length) {
            $J(".tab-next").show();
        } else {
            $J(".tab-next").hide();
        }
    });
    $J(".info-image").click(function(){
        window.open($J(this).attr('href'),'','width=450,height=438');
        return false;
    });
    $J("#questionType").change(function(){
        matrix = parseInt($J(this).val());
        
        $answer  = $J("#modifyQuestionsForm .answer");
        $comment = $J("#modifyQuestionsForm .addComent");
        $row     = $J("#modifyQuestionsForm .RowTextfield");
        $qTxt    = $J("#modifyQuestionsForm .qTextfield");
        
        if (matrix == 3 || matrix == 4) {
            $J("#modifyQuestionsForm .col").css("display", "table-row");            
        } else {
            $J("#modifyQuestionsForm .col").css("display", "none"); 
        }
        if (matrix == 5) {
            $answer.css("display", "none");
            $comment.css("display", "table-row");
            $row.css("display", "none");
            $qTxt.css("display", "table-row");            
        } else if (matrix == 7) {
            $answer.css("display", "none");
            $comment.css("display", "none");
            $row.css("display", "none");
            $qTxt.css("display", "table-row");            
        } else {
            $answer.css("display", "table-row");
            $comment.css("display", "table-row");
            $row.css("display", "none");
            $qTxt.css("display", "table-row");            
        }
        
        $J(".info-image").parent().hide();
        $J("#help"+matrix).show();
    }); 
    $J("#questionType").trigger('change');
});
cx.ready(function(){
    //create the dialog and save a reference
    var d = cx.ui.dialog({
        width   : 500,
        height  : 500,
        title   : '{TXT_SURVEY_MODIFY_QUESTION}',
        content : $J('#modifyQuestionsForm'),
        autoOpen: false,
        buttons: {
            Cancel: function() {
                $J( this ).dialog( "close" );
            },
            "{TXT_SURVEY_OK}": function() {
                $J.ajax({
                    url      : "index.php?cmd=jsondata&object=survey&act=modifyQuestions&surveyId={SURVEY_ID}",
                    type     : "post",
                    data     : $J( "#addsurvey" ).serialize(),
                    dataType : "json",                    
                    beforeSend: function() {
                        cx.tools.StatusMessage.showMessage("<div id=\"loading\">" + jQuery('#loading').html() + "</div>");
                    },
                    complete: function() {
                        cx.tools.StatusMessage.removeAllDialogs();
                    },
                    success  : function(response) {
                        console.log(response);
                         if (response.status == 'success') {
                             response.data;
                         } else {
                             cx.tools.StatusMessage.showMessage(response.message, "error", 1000);
                         }
                     }
                 });
                $J( this ).dialog( "close" );
            }
        },
        close: function() {
            $J("#addsurvey").trigger('reset');
            $J("#questionType").trigger('change');
        }
    });

    $J( ".add_question" ).click(function(){
        d.open();
    });
});
</script>
<form name="modify_servey" method="post" action="">
    <ul id="tabmenu">
        <li><a id="surveyTab_survey" class="active" href="javascript:{}" onclick="selectTab('survey');" title="{TXT_SURVEY_GENERAL}">{TXT_SURVEY_GENERAL}</a></li>
        <li><a id="surveyTab_start" href="javascript:{}" onclick="selectTab('start');" title="{TXT_SURVEY_START}">{TXT_SURVEY_START}</a></li>
        <li><a id="surveyTab_questions" href="javascript:{}" onclick="selectTab('questions');" title="{TXT_SURVEY_QUESTIONS}">{TXT_SURVEY_QUESTIONS}</a></li>
        <li><a id="surveyTab_finish" href="javascript:{}" onclick="selectTab('finish');" title="{TXT_SURVEY_FINISH}">{TXT_SURVEY_FINISH}</a></li>
        <li><a id="surveyTab_feedback" href="javascript:{}" onclick="selectTab('feedback');" title="{TXT_SURVEY_FEEDBACK}">{TXT_SURVEY_FEEDBACK}</a></li>
    </ul>
    <div class="surveyTab" id="survey">
        <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">
            <tr>
                <th colspan="2">{TXT_SURVEY_GENERAL}</th>
            </tr> 
            <tr class="row1">
                <td width="250">{TXT_TITLE}&nbsp;<font color="red">*</font></td>
                <td><input type="text" name="title" id="title" style="width: 250px;" value="{SURVEY_TITLE}"></td>
            </tr>
            <tr class="row2">
                <td valign="top" >{TXT_DESCRIPTION}</td>                
                <td>
                    <textarea name="Description" style="width: 250px; height: 60px;">{SURVEY_DESCRIPTION}</textarea>
                </td>
            </tr>
            <tr class="row1">
                <td>{TXT_UNIQUE_USER_VERIFICATION}&nbsp;<font color="red">*</font></td>
                <td>
                    <label><input type="radio" value="cookie" id="votingRestrictionMethod" name="votingRestrictionMethod" {SURVEY_TYPE_COOKIE} />{TXT_COOKIE_BASED}</label><br/>
                    <label><input type="radio" value="email" id="votingRestrictionMethod" name="votingRestrictionMethod" {SURVEY_TYPE_EMAIL} />{TXT_EMAIL_BASED}</label>
                </td>
            </tr>
        </table>
    </div>
    <div class="surveyTab" id="start" style="display: none;">
        <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">
            <tr>
                <th>{TXT_SURVEY_START}</th>
            </tr>
            <tr class="row1">
                <td>{TXT_BEGINNING_SURVEY}</td>                
            </tr>
            <tr>
                <td>                    
                    {SURVEY_BEGIN_SURVEY}                    
                </td>
            </tr>
        </table>
    </div>
    <div class="surveyTab" id="questions" style="display: none;">
        <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">
            <tr>
                <th colspan="8">{TXT_SURVEY_QUESTIONS}</th>
            </tr>           
            <tr class="row3">
                 <!--td width="2%">&nbsp;&nbsp;#</td>
                 <td style="text-align:center;" width="10%">{TXT_SURVEY_SORTING}</td -->            
                 <td width="20%">{TXT_SURVEY_QUESTION}</td>
                 <td width="15%">{TXT_SURVEY_CREATED_AT}</td>            
                 <td width="20%">{TXT_SURVEY_QUESTION_TYPE}</td>    
                 <td width="15%">{TXT_SURVEY_IS_COMMENTABLE}</td>
                 <td width="5%">{TXT_SURVEY_COUNTER}</td>                      
                 <td style="text-align:right;" width="15%">{TXT_SURVEY_FUNCTIONS}</td>
            </tr>
            <!-- BEGIN ShowQuestions -->
            <tr class="{ENTRY_ROWCLASS}">
                 <!-- td>
                  <input type="checkbox" name="selectedEntriesId[]" id="selectedEntriesId" value="{TXT_SURVEY_ID}" />
                 </td>
                 <td style="text-align:center;">
                      <input type="hidden" name="form_id[]" value="{TXT_SURVEY_ID}" />
                      <input type="text" name="form_pos[]" value="{TXT_SURVEY_POS}" style="width:25px; text-align:right; padding:2px;" />
                 </td -->            
                 <td>{TXT_SURVEY_QUESTION}</td>
                 <td>{TXT_SURVEY_QUESTION_CREATED_AT}</td>
                 <td style="text-align:left;padding-left:2px;">{TXT_SURVEY_QUESTION_TYPE}</td>
                 <td>{TXT_SURVEY_QUESTION_COMMENTABLE}</td>    
                 <td>{TXT_SURVEY_COUNTER}</td>                     
                 <td nowrap="nowrap">
                      <div align="right" style="padding-right:5px;">
                        <a href="../index.php?section=survey&cmd=questionpreview&id={TXT_SURVEY_ID}" title="{TXT_ANALYSE_QUESTION_PREVIEW}" target="_blank" rel="gb_page_fs[]">
                          <img src="images/icons/preview.png" border="0" alt="{TXT_ANALYSE_QUESTION_PREVIEW}" title="{TXT_ANALYSE_QUESTION_PREVIEW}" />
                        </a>		 
                        <a href="index.php?cmd=survey&act=editQuestions&id={TXT_SURVEY_ID}&linkId={TXT_LINKID}" target="_self" title="{TXT_IMAGE_EDIT}">
                          <img src="images/icons/edit.gif" border="0" alt="{TXT_IMAGE_EDIT}" title="{TXT_SURVEY_EDIT_TXT}" />
                        </a>
                        <a href="javascript:deleteEntry({TXT_SURVEY_ID});" target="_self" title="{TXT_IMGALT_DELETE}">
                          <img src="images/icons/delete.gif" border="0" alt="{TXT_IMGALT_DELETE}" title="{TXT_SURVEY_DELETE_TXT}" />
                        </a>
                      </div>
                  </td>
            </tr>
            <!-- END ShowQuestions -->	
            <!-- BEGIN noSurveyQuestions -->	
            <tr>
                <td colspan="8"><i>{TXT_SERVEY_NO_QUESTIONS}</i></td>
            </tr>
            <!-- END noSurveyQuestions -->	            
        </table>
        <br />
        <input class="add_question" type="button" value="{TXT_SURVEY_ADD_QUESTION}">
        <br />
        <br />
    </div>
    <div class="surveyTab" id="finish" style="display: none;">
        <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">
            <tr>
                <th colspan="2">{TXT_SURVEY_FINISH}</th>
            </tr>
            <tr class="row1">
                <td colspan="2">{TXT_ADDITIONALINFO_SURVEY}</td> 
            </tr>
            <tr class="row2">
                <td colspan="2">                   
                    {SURVEY_BEFORE_SUB_INFO}                    
                </td>
            </tr>
            <tr class="row1">
                <td colspan="2">{TXT_BELOW_SUBMIT}</td>                
            </tr>
            <tr class="row2">
                <td colspan="2">                    
                    {SURVEY_BELOW_SUBMIT}                    
                </td>
            </tr>
            <tr class="row1">
                <td width="250">{TXT_ADDITIONAL_FIELDS_LABEL}</td>
                <td>
                    <!-- BEGIN surveyAdditionalFields -->
                    <label>
                        <input type="checkbox" name="additional_{SURVEY_ADDITIONAL_FIELD_NAME}" {SURVEY_ADDITIONAL_FIELD}/>
                        {TXT_SURVEY_ADDITIONAL_FIELD_NAME}
                    </label>
                    <br/>
                    <!-- END surveyAdditionalFields -->
                </td>
            </tr>
        </table>
    </div>
    <div class="surveyTab" id="feedback" style="display: none;">
        <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">
            <tr>
                <th>{TXT_SURVEY_FEEDBACK}</th>
            </tr>
            <tr class="row1">
                <td>{TXT_THANK_MSG}</td>
            </tr>
            <tr class="row2">
                <td>
                   {SURVEY_FEEDBACK_MSG}                    
                </td>
            </tr> 
        </table>
    </div>    
    <br />
    <input type="button" onclick="location.href = 'index.php?cmd=survey&{CSRF_PARAM}';" value="{TXT_SURVEY_CANCEL}" />
    &nbsp;<input class="tab-next" type="button" onclick="modifySurvey._moveToNextTab($J(this));" value="{TXT_SURVEY_NEXT}" />
    &nbsp;<input type="submit" name="save_survey"  value="{TXT_SURVEY_SAVE}" />
</form>

<div id="modifyQuestionsForm" style="display: none;">
    <form id="addsurvey" name="addsurvey" method="post" action="">
        <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">            
            <tr class="row1">
                <td>{TXT_SELECT_QUESTION}&nbsp;<font color="red">*</font></td>
            </tr>
            <tr class="row2">
                <td>
                    <select name="questionType" id="questionType">
                        <option value="">{TXT_QUESTION_TYPE}</option>
                        <option value="1" {TXT_RADIO_SEL}>{TXT_MULTIPLE_CHOICE_ONE_ANSWER}</option>
                        <option value="2" {TXT_CHECK_SEL}>{TXT_MULTIPLE_CHOICE_MULTIPLE_ANSWER}</option>
                        <option value="3" {TXT_MATRIX_SEL}>{TXT_MATRIX_CHOICE_ONE_ANSWER_PER_ROW}</option>
                        <option value="4" {TXT_MATRIXMUL_SEL}>{TXT_MATRIX_CHOICE_MULTIPLE_ANSWER_PER_ROW}</option>
                        <option value="5" {TXT_SINGLEBOX_SEL}>{TXT_SINGLE_TEXTBOX}</option>
                        <option value="6" {TXT_MULTIPLEBOX_SEL}>{TXT_MULTIPLE_TEXTBOX}</option>
                        <option value="7" {TXT_TEXTROW_SEL}>{TXT_TEXT_ROW}</option>
                    </select>
                    <span id="help1"><a class="info-image" href='{SURVEY_IMAGE_PATH}/MC_OA-01.png' title="{TXT_HELP_IMAGE_TXT}">{TXT_HELP_TXT}</a></span>
                    <span id="help2"><a class="info-image" href='{SURVEY_IMAGE_PATH}/MC_MA01.png' title="{TXT_HELP_IMAGE_TXT}">{TXT_HELP_TXT}</a></span>
                    <span id="help3"><a class="info-image" href='{SURVEY_IMAGE_PATH}/matrix_singleAnswer.jpg' title="{TXT_HELP_IMAGE_TXT}">{TXT_HELP_TXT}</a></span>
                    <span id="help4"><a class="info-image" href='{SURVEY_IMAGE_PATH}/matrix_multipleAnswer.jpg' title="{TXT_HELP_IMAGE_TXT}">{TXT_HELP_TXT}</a></span>
                    <span id="help5"><a class="info-image" href='{SURVEY_IMAGE_PATH}/S_TEXT-01.png' title="{TXT_HELP_IMAGE_TXT}">{TXT_HELP_TXT}</a></span>
                    <span id="help6"><a class="info-image" href='{SURVEY_IMAGE_PATH}/M_TEXT-01.png' title="{TXT_HELP_IMAGE_TXT}">{TXT_HELP_TXT}</a></span>
                    <span id="help7"><a class="info-image" href='{SURVEY_IMAGE_PATH}/text_box.jpg' title="{TXT_HELP_IMAGE_TXT}" >{TXT_HELP_TXT}</a></span>
                </td>
            </tr>
            <tr class="row1 qTextfield">
                <td >
                    <span id="labelid">{TXT_QUESTION_TEXT}</span>&nbsp;<font color="red">*</font>
                </td>
            </tr>
            <tr class="row2 qTextfield">
                <td>
                    <input type="text" name="Question" id="Question" style="width: 440px;" />
                </td>
            </tr>            
            <tr class="row1 RowTextfield">
                <td >
                    <span id="labelid">{TXT_TEXT_ROW}</span>&nbsp;<font color="red">*</font>
                </td>
            </tr>
            <tr class="row2 RowTextfield">
                <td >
                    <textarea style="width: 440px;" rows="6" name="QuestionRow" id="QuestionRow">{DB_QUESTION_TITLE}</textarea>  
                </td>
            </tr>
            <tr class="row1 col">
                <td>
                    {TXT_COLUMN_CHOICE}&nbsp;<font color="red">*</font>
                </td>
            </tr>
            <tr class="row2 col">
                <td>
                    <textarea style="width: 440px;" rows="6" name="ColumnChoices" id="ColumnChoices">{DB_COLUMN_OPTIONS}</textarea>
                </td>
            </tr>
            <tr class="row1 answer">
                <td>
                    {TXT_ANSWER_CHOICE}&nbsp;<font color="red">*</font>
                </td>
            </tr>
            <tr class="row2 answer">
                <td>                    
                    <textarea style="width: 440px;" rows="6" name="QuestionAnswers" id="QuestionAnswers">{DB_QUESTION_OPTIONS}</textarea>
                </td>
            </tr>

            <tr class="row1 addComent">
                <td>{TXT_ADD_COMMENT}</td>
            </tr>
            <tr class="row2 addComent">
                <td>
                    <label>
                        <input type="radio" value="1" id="Iscomment" name="Iscomment" {SELECT_COMMENTABLE_YES}/>
                        {TXT_YES}
                    </label>
                    <label>
                        <input type="radio" value="0" id="Iscomment" checked name="Iscomment" {SELECT_COMMENTABLE_NO}/>
                        {TXT_NO}
                    </label>
                </td>
            </tr>
        </table>        
    </form>
</div>