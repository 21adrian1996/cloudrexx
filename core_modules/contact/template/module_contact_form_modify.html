<!-- START module_contact_form_modify.html -->
<script type="text/javascript">
    <!--
    Style[0]=["","","","","",,"black","#ffffe1","","","",,,,1,"#000000",2,21,0.3,,2,"gray",1,,15,5];
    Text[0]=["","{TXT_CONTACT_FEEDBACK_EXPLANATION}"];
    Text[1]=["","{TXT_CONTACT_CAPTCHA_DESCRIPTION}"];
    Text[2]=["","{TXT_CONTACT_SEND_COPY_DESCRIPTION}"];
    Text[3]=["","{TXT_CONTACT_CUSTOM_STYLE_DESCRIPTION}"];
    Text[4]=["","{TXT_CONTACT_SEPARATE_MULTIPLE_VALUES_BY_COMMA}"];

    var formFieldLastId = {CONTACT_FORM_FIELD_NEXT_ID};
    var formRecipientLastId = {CONTACT_FORM_RECIPIENT_NEXT_ID};
    var sort = {CONTACT_FORM_RECIPIENT_NEXT_SORT};

    function switchBoxAndTab(objElement, strTabId) {
        if (countActiveLanguages() == 0) {
            //We just "unchecked" the last language, disallow this
            objElement.checked = true;
        } else {
            //There are more active languages, hide the tab
            switchTabVisibility(strTabId);
        }
    }

    function switchTabVisibility(strTabId) {
        if (document.getElementById(strTabId).style.display == 'none') {
            document.getElementById(strTabId).style.display = 'inline';
        } else {
            document.getElementById(strTabId).style.display = 'none';
        }
    }

    function countActiveLanguages() {
        var activeLanguages = 0;

        for (var h=0; h < document.forms.length;h++) {
            for (var i=0; i < document.forms[h].elements.length;i++) {
                //read out all form-elements with the loop
                if(document.forms[h].elements[i].name.search('contactFormLanguages') != -1) {
                    if(document.forms[h].elements[i].checked) {
                        activeLanguages++;
                    }
                }
            }
        }
        return activeLanguages;
    }

    function addRecipient()
    {
        var number = 0;
        // find the highest number
        $J('.languageValueDiv').each(function(key, elem){
            var nr = parseInt($J(elem).attr('id').split('_')[1]);
            if (nr > number) {
                number = nr;
                divToCopy = elem;
            }
        });

        number++;
        var toCopy = $J('.formRecipient:last');
        var copy = $J(toCopy).clone();

        $J(copy).find('input, select, .languageValueDiv').each(function(key, elem) {
            var name = $J(elem).attr('name');
            var id = $J(elem).attr('id');

            if (name != undefined) {
                // the divs don't have names
                $J(elem).attr('name', name.replace(/([^\[\]]+)\[(\d+)\](\[\d+\])?$/, "$1[" + number + "]$3"));
            }

            // do the id too
            $J(elem).attr('id', id.replace(/^(.*?)_(\d+)$/, "$1_" + number));
        });

        $J(copy).find('.langToggleLink').attr('onclick', '');
        $J(copy).find('.langToggleLink').unbind('click').bind('click', function() {
            toggleLanguages(number);
        });

        $J(copy).find('input').val('');
        $J(copy).find('input[type=hidden]').val('new');
        $J(copy).toggleClass('row1 row2');
        $J('#formRecipientContainer').append(copy);
    }

    /**
    Add a new section for a form field
    */
    function addFormField() {
        /**
        Have count of the number of formfields added dynamically
        */
        var formFieldNumber = 1;

        /**
        Clone the formField element last created
        */
        divToCopy = $J('.formField:last');

        /**
        Get the Form ID of the Fields at the last of the present form
        */
        var previousFormID = parseInt($J('.formField:last').find('.formFieldId').text());

        /**
        Find the last Field Id to Increment the id of added field
        */
        $J('#formFields .formField .formFieldId').each(function(index, element){
            var currentid = parseInt($J(element).text());
            formFieldNumber = (formFieldNumber > currentid)?formFieldNumber:currentid;
        });
        formFieldNumber++;

        var copy = divToCopy.clone();
        $J(copy).attr('id', 'formField_' +formFieldNumber)
        //Increment the Form Feild ID to Display
        $J(copy).find('.formFieldId').html(formFieldNumber);
        //Alter the Row classname to change background color
        $J(copy).toggleClass('row1 row2');

        $J('#formFields').append(copy);
        $J(copy).find('input, select').each(function(key, elem) {
            var name = $J(elem).attr('name');
            var id = $J(elem).attr('id');

            //var number = parseInt(name.match(/\[(\d+)\](?:\[\d+\])?$/)[1]);
            // this regex was quite bitchy... (especially because the page reload
            // took up to 35 seconds... nice testing)
            $J(elem).attr('name', name.replace(/([^\[\]]+)\[(\d+)\](\[\d+\])?$/, "$1[" + formFieldNumber + "]$3"));

            // do the id too
            $J(elem).attr('id', id.replace(/^(.*?)_(\d+)$/, "$1_" + formFieldNumber));
        });

        //Increment the class name of td on add each new fieldform
        $J(copy).find('td').each(function(key, elem) {
            var className = $J(elem).attr('class');
            var id = $J(elem).attr('id');
            // do the class too
            $J(elem).attr('class', className.replace(/^(.*?)_(\d+)$/, "$1_" + formFieldNumber));
            // do the id too
            $J(elem).attr('id', id.replace(/^(.*?)_(\d+)$/, "$1_" + formFieldNumber));
        });

        /**
        set the value of field type select with the value of
        the previous form field type select on adding new formfield
        */
        var previousType = $J("#contactFormFieldType_" +previousFormID).val();
        if (previousType == 'recipient') {
            $J("#contactFormFieldType_"+formFieldNumber).val('text');
            $J("#contactFormFieldType_"+formFieldNumber).change();
        } else {
            $J("#contactFormFieldType_"+formFieldNumber).val($J("#contactFormFieldType_" +previousFormID).val());
        }
        $J(copy).find('input').val('');
        $J(copy).find('input[type=hidden]').val('new');
        $J(copy).find('input[type=checkbox]').attr("checked", false);
    }

    /**
    Remove a form field
    */
    function removeFormField(obj) {
        // at least one field has to be there
        if ($J('.formField').size() > 1) {
            if ($J(obj).parent().parent().find('.contactFormFieldType').val() == 'recipient') {
                $J('.tab_recipients').css('display','none');
            }
            var remObj = $J($J(obj).parent()).parent();
            $J(remObj).remove();
        }
    }

    /**
    Change value fields onchange with the select box to Jquery script
    hide/show the mandatory and type field depending on selected field type    
    */
    function setFormFieldAttributeBox(el, type)
    {
        elId    = el.substr(21);
        elField = $J('#contactFormFieldAttributeBox_'+elId);

        /**
         * Check for recipent field to hide/show recipient list
         */
        if (type == "recipient") {
            if ($J('.tab_recipients').is(":visible") == false) {
                $J('.tab_recipients').css('display','block');
            } else {
                alert('{TXT_CONTACT_RECIPIENT_ALREADY_SET}');
                $J("#contactFormFieldType_"+elId).val('text');
                setFormFieldAttributeBox(el, 'text');
                return false;
            }
        } else {
            var found = 0;
            $J('.formField').each(function(e){
                if ($J(this).find('.contactFormFieldType').val() == 'recipient') {
                    found = 1;
                    return true;
                }
            });

            if (found == 0) {
                $J('.tab_recipients').css('display','none');
            }
        }
        
        elField.html('');
            
        //Change the value fields dynamically with respect to type field
        if($J('#formField'+type+'Attribute_0').length > 0){
            $J(elField).html($J('#formField'+type+'Attribute_0').html());
            $J(elField).children(0).attr('name', 'contactFormFieldValue['+elId+']');
        }

        /**
        Add or remove the mandatory checkbox and value type select box
        with respect to change in the fields type select box
        */
        switch(type){
        case 'text':
        case 'password':
        case 'textarea':
            if($J('#contactFormFieldRequired_'+elId).length == 0){
                var requiredCopy = $J('#contactFormFieldRequired_0').clone(true);
                $J(requiredCopy).attr('id', 'contactFormFieldRequired_'+elId);
                $J(requiredCopy).attr('name', 'contactFormFieldRequired[' + elId+']');
                $J('#contactFormFieldCheckBox_'+elId).append(requiredCopy);
            }

            if($J('#contactFormFieldCheckType_'+elId).length == 0){
                var checkTypeCopy = $J('#contactFormFieldCheckType_0').clone(true);
                $J(checkTypeCopy).attr('id', 'contactFormFieldCheckType_'+elId);
                $J(checkTypeCopy).attr('name', 'contactFormFieldCheckType[' + elId+']');
                $J('#contactFormFieldCheckMenu_'+elId).append(checkTypeCopy);
            }
        break;

        case 'label':
        case 'hidden':
        case 'recipient':
        case 'horizontalLine':
        case 'fieldset':
            ($J('#contactFormFieldRequired_'+elId).length > 0) ? $J('#contactFormFieldRequired_'+elId).remove() : '';
            ($J('#contactFormFieldCheckType_'+elId).length > 0) ? $J('#contactFormFieldCheckType_'+elId).remove() : '';
        break;

        case 'checkbox':
        case 'checkboxGroup':
        case 'country':
        case 'date':
        case 'file':
        case 'radio':
        case 'select':
            var requiredCopy = $J('#contactFormFieldRequired_0').clone(true);
            $J(requiredCopy).attr('id', 'contactFormFieldRequired_'+elId);
            $J(requiredCopy).attr('name', 'contactFormFieldRequired[' + elId+']');
            ($J('#contactFormFieldRequired_'+elId).length == 0) ? $J('#contactFormFieldCheckBox_'+elId).append(requiredCopy) : '';
            ($J('#contactFormFieldCheckType_'+elId).length > 0) ? $J('#contactFormFieldCheckType_'+elId).remove() : '';
        break;

        default:
        break;
        }

        $J('.formValueView input').css('width','90%');
        $J('.formValueView select').css('width','93%');
    }

    function checkFieldValue()
    {
        var elField, i, n, k,j, isSetAllValue;
        var arr;
        arr = ["checkboxGroup", "radio", "select"];

        isSetAllValue = true;
        for (n=1; n<formFieldLastId; n++ ){
            if (document.getElementById('contactFormFieldAttributeBox_'+n)){
                k = -1;
                for (var j=0; j < arr.length; j++) {
                    if (arr[j] == document.getElementById('contactFormFieldType_'+n).value ) {
                        k=j;
                        break
                    }
                }

                if (k != -1) {
                    elField = document.getElementById('contactFormFieldAttributeBox_'+n);
                    for (i=0; i<elField.childNodes.length; i++) {
                        if (elField.childNodes[i].nodeType == 1) {
                            if (elField.childNodes[i].value == '') {
                                isSetAllValue = false;
                            }
                        }
                    }
                }
            }
        }

        return isSetAllValue;
   }

    function createContentSite()
    {
        if (checkFieldValue()) {
            if (confirm('{TXT_CONTACT_CONFIRM_CREATE_CONTENT_SITE}')) {
                document.getElementById('contentSiteAction').value = "create";
            }
            return true;
        } else {
            alert ("{TXT_CONTACT_SET_MANDATORY_FIELD}");
            return false;
        }
    }

    function updateContentSite()
    {
        if (confirm('{TXT_CONTACT_CONFIRM_UPDATE_CONTENT_SITE}')) {
            document.getElementById('contentSiteAction').value = "update";
        }
        return true;
    }


    /**
    Select the super tab according to the name

    @author  Stefan Heinemann <sh@adfinis.com>
    @param   string name
    */
    function superTab(name) {
        $J('.tabs').hide();
        $J('#tab_' + name).show();
    }

    function langTab(ele, id) {
        $J('.langTabs').hide();
        $J('#langTab_' + id).show();
        $J('.notifylangTabs').hide();
        $J('#notifylangTab_' + id).show();
        $J('#formFields tr').each(function(){
            if ($J(this).attr('id') != "") {
                fieldId = $J(this).attr('id').split('_')[1];
                $J('.fieldNameTabs_'+fieldId).hide();
                $J('#fieldNameTab_'+fieldId+'_'+id).show();
                $J('.fieldValueTabs_'+fieldId).hide();
                $J('#fieldValueTab_'+fieldId+'_'+id).show();
            }
        });
        $J('.tabmenu li a').removeClass('active').addClass('inactive');
        $J(ele).removeClass('inactive').addClass('active');
    }

    $J(document).ready(function() {
        $J('#formFields tbody').sortable({
            placeholder: 'ui-state-highlight',
            handle: '.sort-handle',
            revert: true,
            opacity: 0.6,
            forceHelperSize: true,
            forcePlaceholderSize: true,
            items: 'tr.formField',

            stop: function(event, ui) {
                /*Reset Row classes to maintain the alternate background color*/
                var i=0;
                $J('#formFields tbody > tr.formField').each(function(){
                    $J(this).removeClass('row1 row2');
                    $J(this).addClass('row' + (i++ % 2 == 0 ? 2 : 1));
                });
            },

            start: function(event, ui) {
                $J('.ui-state-highlight').append("<td colspan='10'><div class='nshelper'></div></td>");
                $J('.ui-state-highlight .nshelper').css('width',$J('.ui-state-highlight').css('width'));
                $J('.ui-state-highlight .nshelper').css('height',$J('.ui-state-highlight').css('height'));
            }
        });

        $J('#formRecipientContainer tbody').sortable({
            placeholder: 'ui-state-highlight',
            handle: '.sort-handle',
            revert: true,
            opacity: 0.6,
            forceHelperSize: true,
            forcePlaceholderSize: true,
            items: 'tr.formRecipient',
            stop: function(event, ui) {
                /*Reset Row classes to maintain the alternate background color*/
                var i=0;
                $J('#formRecipientContainer tbody > tr.formRecipient').each(function(){
                    $J(this).removeClass('row1 row2');
                    $J(this).addClass('row' + (i++ % 2 == 0 ? 2 : 1));
                });
            },

            start: function(event, ui) {
                $J('.ui-state-highlight').append("<td colspan='10'><div class='nshelper'></div></td>");
                $J('.ui-state-highlight .nshelper').css('width',$J('.ui-state-highlight').css('width'));
                $J('.ui-state-highlight .nshelper').css('height',$J('.ui-state-highlight').css('height'));
            }
        });

        $J('.formCollapseView input').css('padding-left','0px');
        $J('.formValueView input').css('width','93%');
        $J('.formValueView select').css('width','93%');

        /**
        Check for recipent field to hide/show recipient list
        */
        $J('.formField').each(function(e){
            if ($J(this).find('.contactFormFieldType').val() == 'recipient') {
                $J('.tab_recipients').css('display','block');
                return true;
            }
        });
        $J('#langTab_').css('display','none');
    });

    /**
    Show the language input fields
    */
    function toggleLanguages(id) {
        var obj = $J($J('#languageValues_' + id));
        if (obj.is(':visible')) {
            obj.hide();
        } else {
            obj.show();
        }
    }

    /*
    Remove a recipient row. Prevent from
    removing when there's only one left
    */
    function deleteRecipientRow(obj) {
        if ($J('.formRecipient').size() > 1) {
            $J(obj).parents('tr:first').remove();
        }
    }

    $J(function($){ //this way we can use $ normally, but no prototype stuff can be used inside this fn
        var availableLanguages = []; //available languages (long names)
        var $form; //the content form
        
        $("#ajaxbusy").css({opacity: 0.75}).show();
        $('#ajaxwait').show();
        $form = $('form[name=formModify]');
        window._CONTREXX_FIRST_ACTIVE_TAB = $('#contentLanguages li a.active').attr('title');
        $('#contentLanguages li a').each(function(){
            availableLanguages.push($J(this).text())
        });
        window._CONTREXX_FORCE_SWAP = false;

        //add global ajax evenet handlers
        $("#ajaxbusy")
        .bind("ajaxStart", function(){
            window._CONTREXX_REQUEST_ACTIVE = true;
            $(this)
             .css({opacity: 0.75})
             .show();
            $('#ajaxwait')
             .show();
        })
        .bind("ajaxStop", function(){
            window._CONTREXX_REQUEST_ACTIVE = false;
        });

        $('form[name=formModify] th:first-child').each(
            function(){
                $(this).text($(this).text().replace(/\s\(.*?\)$/, '')+' ('+$('#contentLanguages li a.active').text()+')')
            }
        )

        var submitFormHandler = function(event){
            /*if(location.href.match(/act=new/) && !window.gotPageId){
                $J.ajax({
                    url:'{DIRECTORY_INDEX}?'+$J.param({cmd:"content", act:"edit", {CSRF_KEY}:"{CSRF_CODE}"}),
                    cache: false,
                    async: false,
                    success: function(data){
                        if(!data.pageId || data.pageId < 1){
                           return false;
                        }
                        window.gotPageId = true;
                        $J('input[name=pageId]', $form).val(data.pageId);
                        submitForm(event);
                    },
                    error: submitError,
                    dataType: 'json'
                });
            } else {
                submitForm(event);
            }*/
        }

        var submitForm = function(event){
            $J('#ajaxbusy,#ajaxwait').show();
            event.preventDefault();
            event.stopImmediatePropagation();
            $J('#contentLanguages li a').unbind('click');
            var activeContentTab = $J('#tabmenu a.active').attr('id').replace('editorTab_', '');
            selectTab('content1');
            _CONTREXX_FORCE_SWAP = true;
            var $form   = $J('form[name=formContent]');
            var pageId  = $J('input[name=pageId]', $form).val();
            var $active = $J('#contentLanguages li a.active', $form);
            var last = false;

            var content = getFrameContent();
            $J('textarea[name=html]').data($active.text(), content);
            $J('textarea[name=html]').val(content);

            $J('#contentLanguages li a').each(function(){
                var langId   = $J(this).attr('title').replace(/.*?(\d+)$/, '$1');
                var langName = $J(this).text();

                switchTab(this, langName);

                if($J('form[name=formContent] input[name=newpage]').val() == ''){
                    $J('form[name=formContent] input[name=newpage]').val('{TXT_CONTENT_NO_TITLE}')
                }
                $J('textarea[name=html]', $form).attr('disabled', 'disabled');

                $J('select[name="assignedGroups[]"]', $form).children().attr('selected', 'selected');
                $J('select[name="assignedBackendGroups[]"]', $form).children().attr('selected', 'selected');
                //$J('select[name="assignedBlocks[]"]', $form).children().attr('selected', 'selected');
                var contentData = $J('textarea[name=html]').data(langName);
                var postData = $form.serialize();

                if($J(this).closest('li').is(':last-child')){
                    postData += '&'+$J.param({lastUpdate: 1});
                    if(_CONTREXX_SITEMAP_ENABLED){
                        $J('#ajaxstatus').text('{TXT_PLEASE_WAIT_SITEMAP}');
                    }
                }

                postData += '&'+$J.param({  html:   contentData,
                                            langId: $J(this).attr('title').replace(/.*?(\d+)$/, '$1'),
                                            langName: $J(this).attr('title').replace(/(.*?)_\d+$/, '$1')});
                $J('textarea[name=html]', $form).removeAttr('disabled');

                $J.ajax({
                    async:       false,
                    cache:       false,
                    complete:    submitComplete,
                    data:        postData,
                    processData: false,
                    dataType:    'json',
                    success:     function(data, textStatus){
                                    submitSuccess(data, textStatus);
                                    if(typeof data != 'undefined' && data.lastUpdate){
                                        last = true;
                                    }
                                 },
                    error:       submitError,
                    type:        'POST',
                    url:         '{DIRECTORY_INDEX}?cmd=content&act={CONTENT_FORM_ACTION}'
                });

                $J.ajax({
                   url: '{DIRECTORY_INDEX}?cmd=content&act=JSON&data=history',
                   type: 'POST',
                   async: true,
                   cache: false,
                   data: {page: pageId , lang: langId},
                   dataType: 'html',
                   success:
                       function(data){
                            $J('#content5').data(langName, data);
                            $J('#content5').html(data);
                            if(last){ //only hide if it was the last update request
                                $J("#ajaxbusy,#ajaxwait").hide();
                                $J('#ajaxstatus').text('');
                            }else{
                                $J("#ajaxbusy,#ajaxwait").show();
                            }
                       },
                   error: setDataFetchError
                });
            });
            _CONTREXX_FORCE_SWAP = false;
            if(location.href.match(/act=new/) || $J.browser.msie || $J('input[name=expertmode]', $form).attr('checked') != _CONTREXX_EXPERT_MODE){
                goToUrlCSRF('{DIRECTORY_INDEX}?cmd=content&act=edit&pageId='+pageId);
                return false;
            }
            switchTab($active.get(0), $active.text());
            selectTab(activeContentTab);
            $J("#ajaxbusy,#ajaxwait").show();
            return false;
        }
        
        var getContentData = function(a){
            var pageId = $J('form[name=formContent] input[name=pageId]').val();
            var langId = $J(a).attr('title').replace(/.*?(\d+)$/, '$1');
            var langName = $J(a).text();

            if(location.href.match(/act=new/) && (m = location.href.match(/pageId=(\d+)/))){
                pageId = m[1]; //set lang id to copy from if we're copying
            }

            $J.ajax({
               url: '{DIRECTORY_INDEX}?cmd=content&act=JSON&data=inputText',
               type: 'POST',
               async: true,
               cache: false,
               data: {page: pageId , lang: langId, langName: langName},
               dataType: 'json',
               success: setInputText,
               error: setDataFetchError
            });

            $J.ajax({
               url: '{DIRECTORY_INDEX}?cmd=content&act=JSON&data=inputRadio',
               type: 'POST',
               async: true,
               cache: false,
               data: {page: pageId , lang: langId, langName: langName},
               dataType: 'json',
               success: setInputRadio,
               error: setDataFetchError
            });

            $J.ajax({
               url: '{DIRECTORY_INDEX}?cmd=content&act=JSON&data=inputCheckbox',
               type: 'POST',
               async: true,
               cache: false,
               data: {page: pageId , lang: langId, langName: langName},
               dataType: 'json',
               success: setInputCheckbox,
               error: setDataFetchError
            });

            $J.ajax({
               url: '{DIRECTORY_INDEX}?cmd=content&act=JSON&data=select',
               type: 'POST',
               async: true,
               cache: false,
               data: {page: pageId , lang: langId, langName: langName},
               dataType: 'json',
               success: setSelect,
               error: setDataFetchError
            });


            $J.ajax({
               url: '{DIRECTORY_INDEX}?cmd=content&act=JSON&data=history',
               type: 'POST',
               async: true,
               cache: false,
               data: {page: pageId , lang: langId},
               dataType: 'html',
               success: function(data, textStatus){$J('#content5').data(langName, data)},
               error: setDataFetchError
            });
        }

        var getTabData = function(a){
            var langName = $J(a).text();
            if(typeof $J('select[name=category]', $form).data(langName) != 'undefined' || $J(a).attr('title') == _CONTREXX_FIRST_ACTIVE_TAB){        //return if we have already have the data for this language
                return false;
            }
            //getNavMenu(a);
            if(location.href.match(/formId=\d+/)){//fill contents from DB if we are editing or copying
             //   getContentData(a);
            }
        }

        var makeTabActive = function(aElement){
            var $a = $J(aElement);
            $J('#contentLanguages li a').removeClass('active').addClass('inactive');
            $a.removeClass('inactive').addClass('active');
            var timeOut = setTimeout(function(){
                $J('#contentLanguages li a').one('click', function(){
                    switchTab(this);
                })
            }, 800);
        }

        var filterInputs = function(){
            return $J(this).attr('id') != 'selectedChangelogId';
        }

        var swapLanguage = function(aElement, langName){
            var $a = $J(aElement);

            $J('form[name=formModify] th:first-child').each(
                function(){
                    $J(this).text($J(this).text().replace(/\s\(.*?\)$/, '')+' ('+$a.text()+')')
                }
            )

            $J('form[name=formModify] input').removeAttr('disabled');

            if($a.is('.active') && !_CONTREXX_FORCE_SWAP){
                return false;
            }

            //reset undo history
            if(typeof CKEDITOR != 'undefined' && CKEDITOR.instances.html && CKEDITOR.instances.html.resetUndo){
                CKEDITOR.instances.html.resetUndo()
            }

            var lastActive = $J('#contentLanguages li a.active').text();
            var $iFrame    = $form.find('iframe');
            var $textarea  = $form.find('textarea[name=html]');

            if(typeof langName == 'undefined'){
                $textarea.data(lastActive, getFrameContent());    //save frame contents for current lang
                typeof $textarea.data($a.text()) == 'undefined'   //load frame contents for new lang
                  ?  setFrameContent('', lastActive)
                  :  setFrameContent($textarea.data($a.text()), lastActive);
            }
            getTabData(aElement); //get nav menu dropdown and content data

            if(location.href.match(/act=edit/)){
                $J('#content5').data(lastActive, $J('#content5').html());
                $J('#content5').html($J('#content5').data($a.text()));
            }

            $J('#aliastarget').data(lastActive, $J('#aliastarget').text());
            typeof $J('#aliastarget').data($a.text()) == 'undefined'
              ? $J('#aliastarget').text('')
              : $J('#aliastarget').text($J('#aliastarget').data($a.text()))

            $form.find('input[type=text]').each(function(){ //swap input text contents
                var that = this;
                var inputName = $J.trim($J(this).attr('name'));
                switch(inputName){
                    case 'command':
                        //contact module may have different commands
                        var moduleName = $J.trim($J('[name=selectmodule] option:selected').text());
                        if(moduleName == 'contact'){
                                $J(this).data(lastActive, $J(this).val());
                        } else {
                            $J(availableLanguages).each(function(index, name){
                                $J(that).data(name, $J(that).val());
                            });
                        }
                    break;
                    default:
                        $J(this).data(lastActive, $J(this).val());
                }
                typeof $J(this).data($a.text()) == 'undefined'
                    ? $J(this).val('')
                    : $J(this).val($J(this).data($a.text()));
            });

            $form.find('input[type=radio]:checked').each(function(){ //swap input radio buttons
                var $radio = $J($form.find('input[name='+$J(this).attr('name')+']:first'));
                //wtf, if the following line is uncommented then switching the TypeSelection radio buttons doesn't work in FF when in expertmode
                console.log($form.find('[name='+$J(this).attr('name')+'][value='+$radio.data($a.text())+']'));
                $radio.data(lastActive, $J(this).val());
                typeof $radio.data($a.text()) == 'undefined'
                    ? $radio.click()
                    : $form.find('[name='+$J(this).attr('name')+'][value='+$radio.data($a.text())+']').click();
            });

            var $unchecked = $form.find('input[type=checkbox]:not(:checked)');
            $form.find('input[type=checkbox]:checked').each(function(){ //swap input checkboxes which are checked
                if($J(this).attr('name') == 'expertmode'){
                    return;
                }
                $J(this).data(lastActive, $J(this).attr('checked'));
                if(typeof $J(this).data($a.text()) == 'undefined'){
                    $J(this).attr('checked', 'checked');
                }else{
                    if( !(($J(this).data($a.text()) && $J(this).data(lastActive)) || (!$J(this).data($a.text()) && !$J(this).data(lastActive))) ){
                        $J(this).click();
                    }
                }
            });

            $unchecked.each(function(){ //swap input checkboxes which are not checked
                if($J(this).attr('name') == 'expertmode'){
                    return;
                }
                $J(this).data(lastActive, $J(this).attr('checked'));
                if(typeof $J(this).data($a.text()) == 'undefined'){
                    $J(this).attr('checked', false);
                }else{
                    if( !( ($J(this).data($a.text()) && $J(this).data(lastActive)) || (!$J(this).data($a.text()) && !$J(this).data(lastActive)) ) ){
                        $J(this).click();
                    }
                }
            });

            if($J('#type_useContentFromLang tr.row2').data(langName) == 'warn'){
                $J('#type_useContentFromLang tr.row2').addClass('warn');
            } else {
                $J('#type_useContentFromLang tr.row2').removeClass('warn');
            }

            $J('input', $form).attr('disabled', 'disabled');

            $form.find('select').each(function(){
                switch($J(this).attr('name')){
                    case 'selectmodule': //module is always the same for all languages
                    case 'formContent_HistoryMultiAction': //do not touch multiaction select
                        return;
                }
                var $options = $J(this).find('option');
                var value    = $J(this).find('option:selected').val();
                $J(this).data(lastActive, {options: $options, value: value});
                if(typeof $J(this).data($a.text()) == 'undefined'){//set default options and value if not yet
                    $J(this)
                    .data($a.text(), {
                                        options : $J(this).data('default').options,
                                        value   : $J(this).data('default').value
                                     }
                    );
                }
                $J(this).empty();
                $J(this).append($J(this).data($a.text()).options);
                $J(this).val($J(this).data($a.text()).value);
            });

            setTitle();

            if($J.browser.msie && $J.browser.version.match(/^\d/)[0] == 6 ){ //redraw tabs because of buggy IE shit ("display: none;" bugs)
                var activeContentTab = $J('#tabmenu a.active').attr('id').replace('editorTab_', '');
                var inactiveContentTab = $J('#tabmenu a:not(.active)').attr('id').replace('editorTab_', '');
                selectTab(inactiveContentTab);
                selectTab(activeContentTab);
            }
        }

        var switchTab = function(aElement, langName){
            $J('#contentLanguages li a').unbind('click');
            $J('#ajaxbusy,#ajaxwait').show();
            var $inputs = $J('input', $form).filter(filterInputs);
            $inputs.attr('disabled', 'disabled');
            swapLanguage(aElement, langName);
            makeTabActive(aElement);
            $J('form[name=formContent] input').removeAttr('disabled');
            if(!_CONTREXX_FORCE_SWAP){
                $J('#ajaxbusy,#ajaxwait').hide();
            }
        }

        if(location.href.match(/formId=\d+/)){ //if we're editing or copying get tab data for all tabs except first one, which is already loaded
            $('#contentLanguages li a.inactive').each(function(){
                getTabData(this);
            });
        }

        $form.submit(submitFormHandler);

        //add click eventhandler to all new tab links
        $('#contentLanguages li a').one('click', function(){        
            switchTab(this);
        });

        if(typeof CKEDITOR != 'undefined'){
            $('#ajaxbusy,#ajaxwait').hide(); //hide if editor has already loaded or we are in expertmode
        }
    });
    // -->
</script>

<!-- Template of Field elements that is to be added dynamically.  -->
<div style="display:none;">
    <div style="display:inline;" id="formFieldtextAttribute_0">
        {CONTACT_FORM_FIELD_TEXT_TPL}
    </div>
    <div style="display:inline;" id="formFieldlabelAttribute_0">
        {CONTACT_FORM_FIELD_NEXT_TEXT_TPL}
    </div>
    <div style="display:inline;" id="formFieldcheckboxAttribute_0">
        {CONTACT_FORM_FIELD_CHECKBOX_TPL}
    </div>
    <div style="display:inline;" id="formFieldcheckboxGroupAttribute_0">
        {CONTACT_FORM_FIELD_CHECKBOX_GROUP_TPL}
    </div>
    <div style="display:inline;" id="formFieldddateAttribute_0">
        {CONTACT_FORM_FIELD_DATE_TPL}
    </div>
    <div style="display:inline;" id="formFieldhiddenAttribute_0">
        {CONTACT_FORM_FIELD_HIDDEN_TPL}
    </div>
    <div style="display:inline;" id="formFieldradioAttribute_0">
        {CONTACT_FORM_FIELD_RADIO_TPL}
    </div>
    <div style="display:inline;" id="formFieldselectAttribute_0">
        {CONTACT_FORM_FIELD_SELECT_TPL}
    </div>
    <div style="width:150px; display:inline;" id="contactFormFieldRequiredBox_0">
        {CONTACT_FORM_FIELD_CHECK_BOX_TPL} {CONTACT_FORM_FIELD_CHECK_MENU_TPL}
    </div>
</div>

<div id="ajaxbusy"></div>
<div id="ajaxwait"><img src="../core_modules/frontendEditing/images/loading.gif" title="{TXT_CONTENT_PLEASE_WAIT}" alt="{TXT_CONTENT_PLEASE_WAIT}" /><p>{TXT_CONTENT_PLEASE_WAIT}<br /><span id="ajaxstatus"> </span> </p></div>

<span class="red" id="errormessagetarget" style="position:fixed; top: 10px;">{CONTENT_STATUS}</span>

<form action="index.php?cmd=contact&amp;act=forms&amp;tpl=save&amp;formId={CONTACT_FORM_ID}" name="formModify" method="post" onsubmit="return {CONTACT_JS_SUBMIT_FUNCTION}">
    <input type="hidden" id="contentSiteAction" name="contentSiteAction" value="nothing" />
    <input type="hidden" name="copy" value="{FORM_COPY}" />


    <table width="100%" cellspacing="0" cellpadding="3" border="0" class="adminlist">
        <tr>
            <th colspan="4">{TXT_LANGUAGE}</th>
        </tr>
        <tr class="row1">
            <td width="10%">{TXT_LANGUAGE}</td>
            <td width="12%" valign="top">{EDIT_LANGUAGES_1}</td>
            <td width="12%" valign="top">{EDIT_LANGUAGES_2}</td>
            <td width="66%" valign="top">{EDIT_LANGUAGES_3}</td>
        </tr>
    </table>
    <br />

    <div>
        <ul id="contentLanguages" class="tabmenu">
            <!-- BEGIN languageTabs -->
            <li>
                <a id="addFrom_{LANG_NAME}" class="{TAB_CLASS_NAME}" style="{CONTACT_LANGTAB_DISPLAY}" onclick="langTab(this, {LANG_ID})" title="{LANG_NAME}" >{LANG_NAME}</a>
            </li>
            <!-- END languageTabs -->
        </ul>
    </div>

    <div class="tabContainer">
        <br/>
        <ul id="tabmenu">
            <li><a onclick="superTab('values')" title="{TXT_FORM_VALUE}">{TXT_FORM_VALUES}</a></li>
            <li><a onclick="superTab('notification')" title="{TXT_FORM_NOTIFICATION}">{TXT_FORM_NOTIFICATION}</a></li>
            <li><a onclick="superTab('settings')" title="{TXT_ADVANCED_SETTINGS}">{TXT_ADVANCED_SETTINGS}</a></li>
        </ul>
    </div>
    <div class="tabs" id="tab_values">
        <table border="0" cellpadding="0" cellspacing="0" class="adminlist" width="100%">
            <tbody style="vertical-align:top;">
                <tr>
                    <th>{TXT_CONTACT_FORM_DATA}</th>
                </tr>
                <tr class="row1" style="height:20px;">
                    <td>
                        <table>
                            <tr>
                                <td width="15%">{TXT_CONTACT_NAME}</td>
                                <td width="90%"><input style="width:300px;" type="text" name="contactFormName[{LANG_ID}]" value="{CONTACT_FORM_NAME}" maxlength="255" /></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <th>{TXT_CONTACT_FORM_DESC}</th>
                </tr>
                <tr class="row2">
                    <td>{CONTACT_FORM_TEXT}</td>
                </tr>
                <tr>
                    <th>{CONTACT_FORM_FIELDS_TITLE}</th>
                </tr>
                <tr>
                    <td>
                        <table id="formFields" border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
                            <tr class="row3">
                                <td width="2%"></td>
                                <td width="3%"><strong>{TXT_CONTACT_ID}</strong></td>
                                <td width="25%"><strong>{TXT_CONTACT_FIELD_NAME}</strong></td>
                                <td width="13%"><strong>{TXT_CONTACT_TYPE}</strong></td>
                                <td width="42%"><strong>{TXT_CONTACT_VALUE_S}</strong></td>
                                <td width="17%"><strong>{TXT_CONTACT_VALIDATION}</strong></td>
                                <td width="10%"><strong>{TXT_CONTACT_MANDATORY_FIELD}</strong></td>
                                <td width="10%"><strong>{TXT_CONTACT_ACTION}</strong></td>
                            </tr>
                            <!-- BEGIN formField -->
                            <tr id="formField_{FORM_FIELD_ID}" class="formField {ROW_CLASS_NAME}" valign="center">
                                <td><div class="sort-handle"><input type="hidden" name="contactFormFieldEditType[{FORM_FIELD_ID}]" value="{FORM_FIELD_TYPE}" id="form_field_type_{FORM_FIELD_ID}" /></div></td>
                                <td class="formFieldId">{FORM_FIELD_ID}</td>
                                <td>
                                    <input type="text" name="contactFormFieldName[{FORM_FIELD_ID}][{LANG_ID}]" value="{FORM_FIELD_NAME}" class="formFieldElementsLang" style="width: 200px;"/>
                                </td>
                                <td valign="top" style="padding:6px 5px 5px;">{CONTACT_FORM_FIELD_TYPE_MENU}</td>
                                <td id="contactFormFieldAttributeBox_{FORM_FIELD_ID}" class="formValueView">
                                    {CONTACT_FORM_FIELD_VALUE}
                                </td>
                                <td valign="top" style="padding:6px 5px 5px;" class="contactFormFieldCheckMenu_{FORM_FIELD_ID}" id="contactFormFieldCheckMenu_{FORM_FIELD_ID}">{FORM_FIELD_CHECK_MENU}</td>
                                <td valign="top" style="padding:6px 62px 5px 5px;" class="contactFormFieldCheckBox_{FORM_FIELD_ID}" id="contactFormFieldCheckBox_{FORM_FIELD_ID}">{FORM_FIELD_CHECK_BOX}</td>
                                <td valign="top" style="padding:6px 5px 5px;">
                                    <a id="removeLink_1" href="javascript:void(0);" onclick="removeFormField(this)">
                                        <img border="0" title="Delete" alt="Delete" src="images/icons/delete.gif">
                                    </a>
                                </td>
                            </tr>
                            <!-- END formField -->
                        </table>
                        <br/>
                        <input type="button" onclick="addFormField()" name="addField" value="{TXT_CONTACT_ADD_OTHER_FIELD}" id="addFieldButton"/>
                        <br/><br/>
                        <div id="tab_recipient_{LANG_ID}" class="tab_recipients" style="display: none;">
                            <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%" id="formRecipientContainer">
                                <thead>
                                    <tr>
                                        <th colspan="4">{CONTACT_FORM_RECIPIENTS_TITLE}</th>
                                    </tr>

                                    <tr class="row3">
                                        <td></td>
                                        <td style="width: 315px;"><strong>{TXT_CONTACT_EMAIL}</strong></td>
                                        <td><strong>{TXT_CONTACT_NAME}</strong></td>
                                        <td>&nbsp;</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- BEGIN contact_form_recipient_list -->
                                    <tr class="formRecipient {ROW_CLASS_NAME}">
                                        <td><div class="sort-handle"><input type="hidden" name="contactFormRecipientEditType[{CONTACT_FORM_RECIPIENT_ID}]" value="{CONTACT_FORM_RECIPIENT_TYPE}" id="form_field_recipient_{CONTACT_FORM_RECIPIENT_ID}" /></div></td>
                                        <td style="vertical-align: top;padding-top:6px;">
                                            <input style="width:300px;" name="contactFormRecipientEmail[{CONTACT_FORM_RECIPIENT_ID}]"
                                                   value="{CONTACT_FROM_RECIPIENT_EMAIL}" />
                                        </td>
                                        <td>
                                            <input style="width: 300px;" class="globalRecipientName" name="contactFormRecipientName[{CONTACT_FORM_RECIPIENT_ID}][{CONTACT_FORM_RECIPIENT_LANG_ID}]"
                                                   value="{CONTACT_FORM_RECIPIENT_NAME}" /> <br />

                                            <div id="languageValues_{CONTACT_FORM_RECIPIENT_ID}" style="display: none;" class="languageValueDiv">
                                                <input type="hidden" name="contactFormRecipientEditType[{CONTACT_FORM_RECIPIENT_ID}]" value="{CONTACT_FORM_RECIPIENT_TYPE}" id="recipient_type_{CONTACT_FORM_RECIPIENT_ID}" />
                                            </div>
                                        </td>
                                        <td style="vertical-align: top;">
                                            <a href="javascript:void(0);" onclick="deleteRecipientRow(this)" class="rowDeleteLink">
                                                <img style="vertical-align:middle;" src="images/icons/delete.gif" alt="{TXT_CONTACT_DELETE}" width="17" height="17" border="0" />
                                            </a>
                                        </td>
                                    </tr>
                                    <!-- END contact_form_recipient_list -->
                                  </tbody>
                                </table>
                            <br/>
                            <input type="button" onclick="addRecipient()" name="addField[{LANG_ID}]" value="{TXT_CONTACT_ADD_RECIPIENT}" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>
                        {TXT_CONTACT_FEEDBACK}
                    </th>
                </tr>
                <tr class="row1">
                    <td>{CONTACT_FORM_FEEDBACK}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div id="tab_notification" class="tabs" style="display:none;">
        <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
            <tr>
                <th colspan="2">{TXT_FORM_NOTIFICATION}</th>
            </tr>
            <tr class="row1" style="height:20px;">
                <td style="width: 18%">{TXT_CONTACT_RECEIVER_ADDRESSES}</td>
                <td>
                    <input style="width: 300px;" type="text" name="contactFormEmail" value="{CONTACT_FORM_EMAIL}" />&nbsp;
                    <img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[4],Style[0])" />
                </td>
            </tr>
            <tr class="row2">
                <td>{TXT_CONTACT_SEND_COPY}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[2],Style[0])" /></td>
                <td><input type="radio" name="contactFormSendCopy" value="1" id="contactFormSendCopy_1" {CONTACT_FORM_SEND_COPY_YES} /><label for="contactFormSendCopy_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormSendCopy" value="0" id="contactFormSendCopy_0" {CONTACT_FORM_SEND_COPY_NO} /><label for="contactFormSendCopy_0">{TXT_CONTACT_NO}</label></td>
            </tr>
            <tr class="row1">
                <td>{TXT_CONTACT_SEND_HTML_MAIL}</td>
                <td><input type="checkbox" name="contactFormHtmlMail" id="contactFormHtmlMail" {CONTACT_FORM_SEND_HTML_MAIL} /></td>
            </tr>
            <tr>
                <td colspan="2">
                    <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
                        <tbody style="vertical-align:top;">
                            <tr class="row1">
                                <td width="18%">{TXT_CONTACT_SUBJECT}</td>
                                <td><input style="width: 300px;" type="text" name="contactFormSubject[{LANG_ID}]" value="{CONTACT_FORM_SUBJECT}" /></td>
                            </tr>
                            <tr>
                                <th colspan="2">{TXT_CONTACT_MAIL_TEMPLATE}</th>
                            </tr>
                            <tr class="row2">
                                <td colspan="2">{CONTACT_MAIL_TEMPLATE}</td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="tab_settings" class="tabs" style="display:none;">
        <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
            <tr>
                <th colspan="2">{CONTACT_FORM_SETTINGS}</th>
            </tr>
            <tr class="row1">
                <td>{TXT_CONTACT_CUSTOM_STYLE}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[3],Style[0])" /></td>
                <td><input type="radio" name="contactFormUseCustomStyle" value="1" id="contactFormUseCustomStyle_1" {CONTACT_FORM_USE_CUSTOM_STYLE_YES} /><label for="contactFormUseCustomStyle_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormUseCustomStyle" value="0" id="contactFormUseCustomStyle_0" {CONTACT_FORM_USE_CUSTOM_STYLE_NO} /><label for="contactFormUseCustomStyle_0">{TXT_CONTACT_NO}</label></td>
            </tr>
            <tr class="row2">
                <td>{TXT_CONTACT_SHOW_FORM_AFTER_SUBMIT}</td>
                <td><input type="radio" name="contactFormShowForm" value="1" id="contactFormShowForm_1" {CONTACT_FORM_SHOW_FORM_YES} /><label for="contactFormShowForm_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormShowForm" value="0" id="contactFormShowForm_0" {CONTACT_FORM_SHOW_FORM_NO} /><label for="contactFormShowForm_0">{TXT_CONTACT_NO}</label></td>
            </tr>
            <tr class="row1">
                <td>{TXT_CONTACT_CAPTCHA_PROTECTION}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[1],Style[0])" /></td>
                <td><input type="radio" name="contactFormUseCaptcha" value="1" id="contactFormUseCaptcha_1" {CONTACT_FORM_USE_CAPTCHA_YES} /><label for="contactFormUseCaptcha_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormUseCaptcha" value="0" id="contactFormUseCaptcha_0" {CONTACT_FORM_USE_CAPTCHA_NO} /><label for="contactFormUseCaptcha_0">{TXT_CONTACT_NO}</label></td>
            </tr>
        </table>
    </div>
    <br />
    <br />
    <br />
    <input type="submit" name="saveForm" value="{TXT_CONTACT_SAVE}" />

    <!-- END module_contact_form_modify.html -->