<!-- START module_contact_form_modify.html -->
<script type="text/javascript">
<!--
Style[0]=["","","","","",,"black","#ffffe1","","","",,,,1,"#000000",2,21,0.3,,2,"gray",1,,15,5];
Text[0]=["","{TXT_CONTACT_FEEDBACK_EXPLANATION}"];
Text[1]=["","{TXT_CONTACT_CAPTCHA_DESCRIPTION}"];
Text[2]=["","{TXT_CONTACT_SEND_COPY_DESCRIPTION}"];
Text[3]=["","{TXT_CONTACT_CUSTOM_STYLE_DESCRIPTION}"];
Text[4]=["","{TXT_CONTACT_SEPARATE_MULTIPLE_VALUES_BY_COMMA}"];

var formFieldLastId = {CONTACT_FORM_FIELD_NEXT_ID};
var formRecipientLastId = {CONTACT_FORM_RECIPIENT_NEXT_ID};
var sort = {CONTACT_FORM_RECIPIENT_NEXT_SORT};

/**
Have count of the number of formfields added dynamically
*/
var formFieldNumber = 1;

function addRecipient()
{
    var number = 0;
    // find the highest number
    $J('.languageValueDiv').each(function(key, elem){
        var nr = parseInt($J(elem).attr('id').split('_')[1]);
        if (nr > number) {
            number = nr;
            divToCopy = elem;
        }
    });

    number++;
    var toCopy = $J('.formRecipient:last');
    var copy = $J(toCopy).clone();

    $J(copy).find('input, select, .languageValueDiv').each(
        function(key, elem) {
            var name = $J(elem).attr('name');
            var id = $J(elem).attr('id');

            if (name != undefined) {
                // the divs don't have names
                $J(elem).attr('name', name.replace(/([^\[\]]+)\[(\d+)\](\[\d+\])?$/, "$1[" + number + "]$3"));
            }

            // do the id too
            $J(elem).attr('id', id.replace(/^(.*?)_(\d+)$/, "$1_" + number));
        }
    );

    $J(copy).find('.langToggleLink').attr('onclick', '');
    $J(copy).find('.langToggleLink').unbind('click').bind('click', function() {
            toggleLanguages(number);
        }
    );

    $J(copy).find('input').val('');
    $J(copy).find('input[type=hidden]').val('new');

    $J('#formRecipientContainer').append(copy);
}

/**
  Add a new section for a form field
  */
function addFormField() {
    /**
    	Clone the formField element last created
    */
    divToCopy = $J('.formField').last();
    formFieldNumber++;
    
    var copy = divToCopy.clone(true);
    $J(copy).attr('id', 'formField_' +formFieldNumber);
	
    $J('#formFields').append(copy);

    $J(copy).find('input, select').each(
        function(key, elem) {
            var name = $J(elem).attr('name');
            var id = $J(elem).attr('id');
            
            //var number = parseInt(name.match(/\[(\d+)\](?:\[\d+\])?$/)[1]);
            // this regex was quite bitchy... (especially because the page reload
            // took up to 35 seconds... nice testing)
            $J(elem).attr('name', name.replace(/([^\[\]]+)\[(\d+)\](\[\d+\])?$/, "$1[" + formFieldNumber + "]$3"));

            // do the id too
            $J(elem).attr('id', id.replace(/^(.*?)_(\d+)$/, "$1_" + formFieldNumber));
        }
    );
    
   	//Increment the class name of td on add each new fieldform
    $J(copy).find('td').each(
    	function(key, elem) {
            var className = $J(elem).attr('class');
            // do the class too
            $J(elem).attr('class', className.replace(/^(.*?)_(\d+)$/, "$1_" + formFieldNumber));
        }
    );
    
    //Increment the span name of td on add each new fieldform
    $J(copy).find('span').each(
    	function(key, elem) {
            var id = $J(elem).attr('id');
            // do the class too
            $J(elem).attr('id', id.replace(/^(.*?)_(\d+)$/, "$1_" + formFieldNumber));
        }
    );
    
    /**
    	set the value of field type select wiyh the value of 
    	the previous form filed type select on adding new formfield 
    */
   	$J("#contactFormFieldType_"+formFieldNumber).val($J("#contactFormFieldType_" +(formFieldNumber-1)).val());

    $J(copy).find('input').val('');
    $J(copy).find('input[type=hidden]').val('new');
}

/**
  Remove a form field
  */
function removeFormField(obj) {
    // at least one field has to be there
    if ($J('.formField').size() > 1) {
        var remObj = $J($J($J(obj).parent()).parent()).parent();
        $J(remObj).remove();
    }
}
  
/**
	Change value fields onchange with the select box to Jquery script
	hide/show the mandatory and type field depending on selected field type
	@parameter -  langId - gets the frontend active languages to name the field elements on change
*/
function setFormFieldAttributeBox(el, type, langId)
{
    elId = el.substr(21);
    elField = $J('.contactFormFieldAttributeBox_'+elId);
	
	elField.html('');    

	//Change the value fields dynamically with respect to type field
	if($J('#formField'+type+'Attribute_0').length > 0 && 'formField'+type+'Attribute_0' != 'formFieldcheckboxAttribute_0'){
		$J(elField).each(function (index, domEle){
			$J(domEle).html($J('#formField'+type+'Attribute_0').html());
			$J(domEle).children(0).attr('name', 'contactFormFieldValue['+elId+']['+langId.split('-')[index]+']');
		});
	} else {
		//For Checkbox only one instance of select box is enough
		$J(elField[0]).html($J('#formField'+type+'Attribute_0').html());
		$J(elField[0]).children(0).attr('name', 'contactFormFieldValue['+elId+'][1]');
	}

	/**
		Add or remove the mandatory checkbox and value type select box 
		with respect to change in the fields type select box
	*/
	switch(type){
		case 'text':
	    case 'file':
        case 'password':
        case 'textarea':        
        	if($J('#contactFormFieldRequired_'+elId).length == 0){
		    	var requiredCopy = $J('#contactFormFieldRequired_0').clone(true);
				$J(requiredCopy).attr('id', 'contactFormFieldRequired_' + elId);
				$J(requiredCopy).attr('name', 'contactFormFieldRequired[' + elId+']');
				$J('#contactFormFieldCheckBox_'+elId).append(requiredCopy);
			}
			
			if($J('#contactFormFieldCheckType_'+elId).length == 0){
				var checkTypeCopy = $J('#contactFormFieldCheckType_0').clone(true);
				$J(checkTypeCopy).attr('id', 'contactFormFieldCheckType_' + elId);
				$J(requiredCopy).attr('name', 'contactFormFieldCheckType[' + elId+']');
				$J('#contactFormFieldCheckMenu_'+elId).append(checkTypeCopy);
			}
			break;
			
		case 'label':
		case 'hidden':
		case 'select':
		case 'recipient':
			($J('#contactFormFieldRequired_'+elId).length > 0) ? $J('#contactFormFieldRequired_'+elId).remove() : '';
			($J('#contactFormFieldCheckType_'+elId).length > 0) ? $J('#contactFormFieldCheckType_'+elId).remove() : '';
			break;
			
        case 'checkbox':
        case 'checkboxGroup':
        case 'date':
        case 'radio':
			var requiredCopy = $J('#contactFormFieldRequired_0').clone(true);
			$J(requiredCopy).attr('id', 'contactFormFieldRequired_' + elId);
			($J('#contactFormFieldRequired_'+elId).length == 0) ? $J('#contactFormFieldCheckBox_'+elId).append(requiredCopy) : '';
			($J('#contactFormFieldCheckType_'+elId).length > 0) ? $J('#contactFormFieldCheckType_'+elId).remove() : '';
			break;
		default:
			break;
	}
}

function checkFieldValue()
{
	var elField, i, n, k,j, isSetAllValue;
	var arr;
	arr = ["checkboxGroup", "radio", "select"];
		
	isSetAllValue = true;
	for (n=1; n<formFieldLastId; n++ ){		
		if (document.getElementById('contactFormFieldAttributeBox_'+n)){
			
			k = -1;
			for (var j=0; j < arr.length; j++) {
			    if (arr[j] == document.getElementById('contactFormFieldType_'+n).value ) {
			    	k=j; 
			    	break
			    } 		
			}
			
			if (k != -1) {
				elField = document.getElementById('contactFormFieldAttributeBox_'+n);	
			    for (i=0; i<elField.childNodes.length; i++) {
		            if (elField.childNodes[i].nodeType == 1) {	                            
		                if (elField.childNodes[i].value == '') {	                	
		                	isSetAllValue = false;
		                }		                
		            }             
			    }
			}		    
		}
	}
	
	return isSetAllValue;

}

function createContentSite()
{
	if (checkFieldValue()) {	
        if (confirm('{TXT_CONTACT_CONFIRM_CREATE_CONTENT_SITE}')) {
            document.getElementById('contentSiteAction').value = "create";
        }
        return true;    
	} else {
		alert ("{TXT_CONTACT_SET_MANDATORY_FIELD}");
		return false;
	}
}

function updateContentSite()
{
    if (confirm('{TXT_CONTACT_CONFIRM_UPDATE_CONTENT_SITE}')) {
        document.getElementById('contentSiteAction').value = "update";
    }
    return true;
}


/**
  Select the super tab according to the name

  @author  Stefan Heinemann <sh@adfinis.com>
  @param   string name 
*/
function superTab(name) {
    $J('.tabs').hide();
    $J('#tab_' + name).show();
}

function langTab(id) {
    $J('.langTabs').hide();
    $J('#langTab_' + id).show();
}

$J(document).ready(function() {
    $J('#formFields').sortable();
    $J('#formRecipientContainer tbody').sortable();
});

/**
    Show the language input fields
 */
function toggleLanguages(id) {
    var obj = $J($J('#languageValues_' + id));
    if (obj.is(':visible')) {
        obj.hide();
    } else {
        obj.show();
    }
}

/*
    Remove a recipient row. Prevent from
    removing when there's only one left
 */
function deleteRecipientRow(obj) {
    if ($J('.formRecipient').size() > 1) {
        $J(obj).parents('tr:first').remove();
    }
}

// -->
</script>

<!-- Template of Field elements that is to be added dynamically.  -->
<div style="display:none;">
    <div style="display:inline;" id="formFieldtextAttribute_0">
        {CONTACT_FORM_FIELD_TEXT_TPL}
    </div>
    <div style="display:inline;" id="formFieldlabelAttribute_0">
        {CONTACT_FORM_FIELD_NEXT_TEXT_TPL}
    </div>
    <div style="display:inline;" id="formFieldcheckboxAttribute_0">
        {CONTACT_FORM_FIELD_CHECKBOX_TPL}
    </div>
    <div style="display:inline;" id="formFieldcheckboxGroupAttribute_0">
        {CONTACT_FORM_FIELD_CHECKBOX_GROUP_TPL}
    </div>
    <div style="display:inline;" id="formFieldddateAttribute_0">
        {CONTACT_FORM_FIELD_DATE_TPL}
    </div>
    <div style="display:inline;" id="formFieldhiddenAttribute_0">
        {CONTACT_FORM_FIELD_HIDDEN_TPL}
    </div>
    <div style="display:inline;" id="formFieldradioAttribute_0">
        {CONTACT_FORM_FIELD_RADIO_TPL}
    </div>
    <div style="display:inline;" id="formFieldselectAttribute_0">
        {CONTACT_FORM_FIELD_SELECT_TPL}
    </div>
    <div style="width:150px; display:inline;" id="contactFormFieldRequiredBox_0">
        {CONTACT_FORM_FIELD_CHECK_BOX_TPL} {CONTACT_FORM_FIELD_CHECK_MENU_TPL}
    </div>

</div>



<ul id="tabmenu">
    <li><a href="#" onclick="superTab('values')" title="{TXT_FORM_VALUE}">{TXT_FORM_VALUES}</a></li>
    <li><a href="#" onclick="superTab('fields')" title="{TXT_FORM_FIELDS}">{TXT_FORM_FIELDS}</a></li>
    <li><a href="#" onclick="superTab('recipients')" title="{TXT_FORM_RECIPIENTS}">{TXT_FORM_RECIPIENTS}</a></li>
    <li><a href="#" onclick="superTab('settings')" title="{TXT_ADVANCED_SETTINGS}">{TXT_ADVANCED_SETTINGS}</a></li>
</ul>
<form action="index.php?cmd=contact&amp;act=forms&amp;tpl=save&amp;formId={CONTACT_FORM_ID}" method="post" onsubmit="return {CONTACT_JS_SUBMIT_FUNCTION}">
<input type="hidden" id="contentSiteAction" name="contentSiteAction" value="nothing" />
<input type="hidden" name="copy" value="{FORM_COPY}" />



<div class="tabs" id="tab_values">

    <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
        <tr>
            <th colspan="2">{CONTACT_ACTION_TITLE}</th>
        </tr>
        <tr class="row2" style="height:20px;">
            <td style="width: 15%">{TXT_CONTACT_RECEIVER_ADDRESSES}</td>
            <td><input style="width: 300px;" type="text" name="contactFormEmail" value="{CONTACT_FORM_EMAIL}" /> *</td>
        </tr>
    </table>
    <br /><br />

    <div style="padding-left: 4px">
        <ul class="tabmenu" style="margin-left: 15%">
            <!-- BEGIN languageTabs -->
            <li>
                <a href="#" onclick="langTab({LANG_ID})" title="{LANG_NAME}" 
                    style="{TAB_DISPLAY}">{LANG_NAME}</a>
            </li>
            <!-- END languageTabs -->
        </ul>
    </div>

    <!-- BEGIN languageForm -->
    <div style="display: {LANG_FORM_DISPLAY};"  id="langTab_{LANG_ID}" class="langTabs">
            <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
                <tbody style="vertical-align:top;">
                    <tr>
                        <th>&nbsp;</th>
                        <th> {LANG_NAME}</th>
                    </tr>
                    <tr class="row1" style="height:20px;">
                        <td width="15%">{TXT_CONTACT_NAME}</td>
                        <td width="90%"><input style="width:300px;" type="text" name="contactFormName[{LANG_ID}]" value="{CONTACT_FORM_NAME}" maxlength="255" /></td>
                    </tr>

                    <tr class="row2">
                        <td>{TXT_CONTACT_SUBJECT}</td>
                        <td><input style="width: 300px;" type="text" name="contactFormSubject[{LANG_ID}]" value="{CONTACT_FORM_SUBJECT}" /></td>
                    </tr>

                    <tr class="row1">
                        <td>{TXT_CONTACT_FORM_DESC}</td>
                        <td>{CONTACT_FORM_TEXT}</td>
                    </tr>
                    <tr class="row2">
                        <td>{TXT_CONTACT_FEEDBACK}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[0],Style[0])" /></td>
                        <td>{CONTACT_FORM_FEEDBACK}</td>
                    </tr>
                  </tbody>
            </table>
    </div>
    <!-- END languageForm -->
</div>

<div id="tab_fields" class="tabs" style="display: none;">
    <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
        <tr>
            <th colspan="2">{CONTACT_FORM_FIELDS_TITLE}</th>
        </tr>
    </table>
    <br />

    <div id="formFields">
    <!-- BEGIN formField -->
        <div class="formField"  id="formField_{FORM_FIELD_ID}" style="background-color: white;">
            <input type="hidden" name="contactFormFieldEditType[{FORM_FIELD_ID}]" value="{FORM_FIELD_TYPE}" id="form_field_type_{FORM_FIELD_ID}" />
            <div style="border: 1px solid #DDE4FF; padding: 10px; position: relative">
                <div style="position: absolute; right: 10px; top: 3px;">
                    <a id="removeLink_1" href="#" onclick="removeFormField(this)">X</a>
                </div>
                <table width="100%">
                    <tr>
                        <th style="width: 20%">{TXT_LANGUAGE}</th>
                        <th style="width: 40%">{TXT_NAME}</th>
                        <th style="width: 40%">{TXT_VALUES}</th>
                    </tr>
                    <!-- BEGIN formFieldRow -->
                    <tr>
                        <td>{FORM_FIELD_ROW_LANG}</td>
                        <td>
                            <input type="text" name="contactFormFieldName[{FORM_FIELD_ID}][{FORM_FIELD_ROW_LANG_ID}]" 
                                value="{FORM_FIELD_NAME}"
                                class="formFieldElementsLang" style="width: 100%"/>
                        </td>
                       	<!-- added class name to td -->
                        <td class="contactFormFieldAttributeBox_{FORM_FIELD_ID}">
                            {CONTACT_FORM_FIELD_VALUE_FIELD}
                        </td>
                    </tr>
                    <!-- END formFieldRow -->
                </table>
                <!--
                	added two span with ids to hide/show mandatory checkbox and type select box
                -->
                {TXT_TYPE}: {CONTACT_FORM_FIELD_TYPE_MENU} <span id='contactFormFieldCheckBox_{FORM_FIELD_ID}'>{FORM_FIELD_CHECK_BOX}</span> <span id='contactFormFieldCheckMenu_{FORM_FIELD_ID}'>{TXT_MANDATORY_FIELD} {FORM_FIELD_CHECK_MENU}</span>
            </div>
            <br />
        </div>
    <!-- END formField -->
    </div>

    <input type="button" onclick="addFormField()" name="addField" value="{TXT_CONTACT_ADD_OTHER_FIELD}" id="addFieldButton"/>
</div>

<div id="tab_recipients" class="tabs" style="display: none;">
   <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%" id="formRecipientContainer">
       <thead>
		    <tr>
		        <th colspan="3">{CONTACT_FORM_RECIPIENTS_TITLE}</th>
		    </tr>

		    <tr class="row3">
		        <td style="width: 315px;"><strong>{TXT_CONTACT_EMAIL}</strong></td>
		        <td><strong>{TXT_CONTACT_NAME}</strong></td>
		        <td>&nbsp;</td>
		    </tr>
		</thead>

        <tbody>

        <!-- BEGIN contact_form_recipient_list -->
        <tr class="formRecipient">
            <td style="vertical-align: top;">
                <input style="width:300px;" name="contactFormRecipientEmail[{CONTACT_FORM_RECIPIENT_ID}]"
                    value="{CONTACT_FROM_RECIPIENT_EMAIL}" />
            </td>
            <td>
                <input style="width: 300px;" name="contactFormRecipientName[{CONTACT_FORM_RECIPIENT_ID}][0]"
                        value="{CONTACT_FORM_RECIPIENT_NAME}" /> <a href="#" onclick="toggleLanguages({CONTACT_FORM_RECIPIENT_ID})" class="langToggleLink">{TXT_CONTACT_EXTEND} &gt;&gt;</a><br />

                <div id="languageValues_{CONTACT_FORM_RECIPIENT_ID}" style="display: none;" class="languageValueDiv">
                <!-- BEGIN recipientNameLang -->
                    <input style="width: 300px;" name="contactFormRecipientName[{CONTACT_FORM_RECIPIENT_ID}][{CONTACT_FORM_RECIPIENT_LANG_ID}]"
                        value="{CONTACT_FORM_RECIPIENT_NAME}" /> {CONTACT_FORM_LANGUAGE_NAME} <br />
                    <!-- END recipientNameLang -->
                    <input type="hidden" name="contactFormRecipientEditType[{CONTACT_FORM_RECIPIENT_ID}]" value="{CONTACT_FORM_RECIPIENT_TYPE}" id="recipient_type_{CONTACT_FORM_RECIPIENT_ID}" />
                </div>
            </td>
            <td style="vertical-align: top;">
                <a href="#" onclick="deleteRecipientRow(this)" class="rowDeleteLink">
                    <img style="vertical-align:middle;" src="images/icons/delete.gif" alt="{TXT_CONTACT_DELETE}" width="17" height="17" border="0" />
                </a>
            </td>
        </tr>
        <!-- END contact_form_recipient_list -->
        </tbody>
    </table>

    <input type="button" onclick="addRecipient()" name="addField[{LANG_ID}]" value="{TXT_CONTACT_ADD_OTHER_FIELD}" />
</div>

<div id="tab_settings" class="tabs" style="display: none">
   <table border="0" cellpadding="3" cellspacing="0" class="adminlist" width="100%">
        <tr>
            <th colspan="2">{CONTACT_FORM_SETTINGS}</th>
        </tr>
    </table>
    <table>
        <tr class="row1">
            <td>{TXT_CONTACT_CUSTOM_STYLE}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[3],Style[0])" /></td>
            <td><input type="radio" name="contactFormUseCustomStyle" value="1" id="contactFormUseCustomStyle_1" {CONTACT_FORM_USE_CUSTOM_STYLE_YES} /><label for="contactFormUseCustomStyle_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormUseCustomStyle" value="0" id="contactFormUseCustomStyle_0" {CONTACT_FORM_USE_CUSTOM_STYLE_NO} /><label for="contactFormUseCustomStyle_0">{TXT_CONTACT_NO}</label></td>
        </tr>
        <tr class="row2">
            <td>{TXT_CONTACT_SHOW_FORM_AFTER_SUBMIT}</td>
            <td><input type="radio" name="contactFormShowForm" value="1" id="contactFormShowForm_1" {CONTACT_FORM_SHOW_FORM_YES} /><label for="contactFormShowForm_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormShowForm" value="0" id="contactFormShowForm_0" {CONTACT_FORM_SHOW_FORM_NO} /><label for="contactFormShowForm_0">{TXT_CONTACT_NO}</label></td>
        </tr>
        <tr class="row1">
            <td>{TXT_CONTACT_CAPTCHA_PROTECTION}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[1],Style[0])" /></td>
            <td><input type="radio" name="contactFormUseCaptcha" value="1" id="contactFormUseCaptcha_1" {CONTACT_FORM_USE_CAPTCHA_YES} /><label for="contactFormUseCaptcha_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormUseCaptcha" value="0" id="contactFormUseCaptcha_0" {CONTACT_FORM_USE_CAPTCHA_NO} /><label for="contactFormUseCaptcha_0">{TXT_CONTACT_NO}</label></td>
        </tr>
        <tr class="row2">
            <td>{TXT_CONTACT_SEND_COPY}&nbsp;<img src="images/icons/note.gif" width="12" height="12" onmouseout="htm()" onmouseover="stm(Text[2],Style[0])" /></td>
            <td><input type="radio" name="contactFormSendCopy" value="1" id="contactFormSendCopy_1" {CONTACT_FORM_SEND_COPY_YES} /><label for="contactFormSendCopy_1">{TXT_CONTACT_YES}</label> <input type="radio" name="contactFormSendCopy" value="0" id="contactFormSendCopy_0" {CONTACT_FORM_SEND_COPY_NO} /><label for="contactFormSendCopy_0">{TXT_CONTACT_NO}</label></td>
        </tr>
    </table>
</div>

<br />
<br />
<br />
<input type="submit" name="saveForm" value="{TXT_CONTACT_SAVE}" />

<!-- END module_contact_form_modify.html -->

